<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</title>
    <script src="https://cdn.tailwindcss.com"> </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ‡¶´‡¶®‡ßç‡¶ü ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶® */
        body {
            font-family: 'Hind Siliguri', Inter, sans-serif;
            background-color: #f7f9fc;
        }

        /* ‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ - ‡¶Ü‡¶ß‡ßÅ‡¶®‡¶ø‡¶ï ‡¶®‡ßÄ‡¶≤ */
        .brand-blue {
            background-color: #0d6efd;
            transition: background-color 0.2s;
        }

        .brand-blue:hover {
            background-color: #0b5ed7;
        }

        .brand-blue-text {
            color: #0d6efd;
        }

        /* ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ - ‡¶è‡¶≤‡¶ø‡¶≠‡ßá‡¶ü‡ßá‡¶° ‡¶≤‡ßÅ‡¶ï */
        .app-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
            transition: box-shadow 0.3s, transform 0.2s;
        }

        .app-card:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            transform: translateY(-1px);
        }

        /* ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶ø‡¶Ç */
        .app-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .app-table th, .app-table td {
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
            /* ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ì ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶ï‡¶Æ ‡¶™‡ßç‡¶Ø‡¶æ‡¶°‡¶ø‡¶Ç */
            white-space: nowrap; /* ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶Æ‡ßã‡ßú‡¶æ‡¶®‡ßã ‡¶è‡ßú‡¶æ‡¶§‡ßá */
        }

        .app-table thead th {
            background-color: #f8f9fa;
            color: #495057;
            font-weight: 600;
            text-align: left;
            text-transform: uppercase;
            font-size: 0.875rem;
        }

        .app-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        /* ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .custom-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            transition: opacity 0.3s ease;
        }
        
        .custom-modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 450px; 
            text-align: center;
            animation: zoomIn 0.3s ease-out;
        }
        
        .custom-modal-actions {
            margin-top: 1.5rem;
            display: flex;
            justify-content: space-around;
            gap: 1rem;
        }
        
        .custom-modal-btn {
            flex: 1;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 9999px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }
        
        /* ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .report-card {
            background: #fff;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border-left: 5px solid #f59e0b;
        }
        
        .report-card.bug { border-left-color: #ef4444; }
        .report-card.suggestion { border-left-color: #3b82f6; }
        .report-card.security { border-left-color: #10b981; }
    </style>
</head>
<body>
    
    <div class="container max-w-6xl mx-auto p-4 md:p-8">
        <header class="app-card p-6 text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 flex items-center justify-center gap-4">
                <i class="fas fa-tools brand-blue-text"></i>
                ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°
            </h1>
        </header>
        
        <div class="app-card p-6">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 border-b pb-4">
                <h2 class="text-xl font-bold text-gray-800 mb-4 md:mb-0">‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2>
                <div class="tabs flex flex-wrap gap-2 md:gap-4">
                    <button class="tab px-4 py-2 rounded-full text-sm font-semibold transition-colors duration-200 bg-blue-600 text-white active" data-tab="users">
                        <i class="fas fa-users mr-2"></i> ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ
                    </button>
                    <button class="tab px-4 py-2 rounded-full text-sm font-semibold transition-colors duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300" data-tab="tasks">
                        <i class="fas fa-list-check mr-2"></i> ‡¶ï‡¶æ‡¶ú‡¶∏‡¶Æ‡ßÇ‡¶π
                    </button>
                    <button class="tab px-4 py-2 rounded-full text-sm font-semibold transition-colors duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300" data-tab="proofs">
                        <i class="fas fa-file-circle-check mr-2"></i> ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â
                    </button>
                    <!-- ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
                    <button class="tab px-4 py-2 rounded-full text-sm font-semibold transition-colors duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300" data-tab="reports">
                        <i class="fas fa-bug mr-2"></i> ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü
                    </button>
                    <!-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ -->
                    <button class="tab px-4 py-2 rounded-full text-sm font-semibold transition-colors duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300" data-tab="settings">
                        <i class="fas fa-cog mr-2"></i> ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
                    </button>
                </div>
            </div>

            <div id="users" class="tab-content active">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                <div class="overflow-x-auto">
                    <table class="app-table">
                        <thead>
                            <tr>
                                <th>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID</th>
                                <th>‡¶®‡¶æ‡¶Æ</th>
                                <th>‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü</th>
                                <th>‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶°</th>
                                <th>‡¶∞‡ßã‡¶≤</th>
                                <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="tasks" class="tab-content hidden">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">‡¶ï‡¶æ‡¶ú‡¶∏‡¶Æ‡ßÇ‡¶π ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                <div class="overflow-x-auto">
                    <table class="app-table">
                        <thead>
                            <tr>
                                <th>‡¶Ü‡¶á‡¶°‡¶ø</th>
                                <th>‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞</th>
                                <th>‡¶≤‡¶ø‡¶Ç‡¶ï</th>
                                <th>‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü</th>
                                <th>‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</th>
                                <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                            </tr>
                        </thead>
                        <tbody id="tasks-table-body">
                            </tbody>
                    </table>
                </div>
            </div>
            
            <div id="proofs" class="tab-content hidden">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡ßÅ‡¶´</h3>
                <div id="proofs-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Proofs will be rendered here -->
                </div>
            </div>
            
            <!-- ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
            <div id="reports" class="tab-content hidden">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h3>
                <div id="reports-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Reports will be rendered here -->
                </div>
            </div>
            <!-- ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶∂‡ßá‡¶∑ -->

            <!-- üî• ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
            <div id="settings" class="tab-content hidden">
                <h3 class="text-2xl font-semibold text-gray-700 mb-6 text-center">‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    
                    <!-- ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ -->
                    <div class="p-6 app-card space-y-4">
                        <h4 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4 flex items-center gap-2"><i class="fas fa-share-alt brand-blue-text"></i> ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h4>
                        
                        <!-- referredUser ‡¶á‡¶®‡¶™‡ßÅ‡¶ü -->
                        <div>
                            <label for="referredBonus" class="block text-sm font-medium text-gray-700 mb-2">
                                ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßç‡¶° ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ (referredUser):
                            </label>
                            <input type="number" id="referredBonus" min="0" class="w-full p-3 border border-blue-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ï‡¶§ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶¨‡ßá">
                        </div>

                        <!-- refereeUser ‡¶á‡¶®‡¶™‡ßÅ‡¶ü -->
                        <div>
                            <label for="refereeBonus" class="block text-sm font-medium text-gray-700 mb-2">
                                ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ (refereeUser):
                            </label>
                            <input type="number" id="refereeBonus" min="0" class="w-full p-3 border border-green-300 rounded-lg focus:ring-green-500 focus:border-green-500" placeholder="‡¶Ø‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá ‡¶∏‡ßá ‡¶ï‡¶§ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶¨‡ßá">
                        </div>

                        <button id="saveReferralSettingsBtn" class="w-full brand-blue text-white py-3 rounded-lg font-bold hover:brightness-110 transition duration-200">
                            <i class="fas fa-save mr-2"></i> ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>
                        <p id="referral-status" class="text-center text-sm mt-2 text-gray-500 hidden"></p>
                    </div>

                    <!-- üî• ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ (‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá) -->
                    <div class="p-6 app-card space-y-4">
                        <h4 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4 flex items-center gap-2"><i class="fas fa-tags text-yellow-600"></i> ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ (‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡ßá‡¶ú)</h4>
                        
                        <p class="text-gray-600 text-sm mb-4">
                            ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶™‡¶æ‡¶•: <code>controls/productPoints</code>
                        </p>
                        
                        <!-- Product Points Input Group (Updated for Task Types) -->
                        <div id="product-points-inputs" class="space-y-4">
                            
                            <!-- 1. react -->
                            <div>
                                <label for="react_points" class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                    <i class="fas fa-thumbs-up text-blue-600"></i> ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶ï‡ßç‡¶ü ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü (react):
                                </label>
                                <input type="number" id="react_points" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500" placeholder="‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶ï‡ßç‡¶ü ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü">
                            </div>

                            <!-- 2. Comment -->
                            <div>
                                <label for="comment_points" class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                    <i class="fas fa-comment text-indigo-600"></i> ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü (comment):
                                </label>
                                <input type="number" id="comment_points" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500" placeholder="‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü">
                            </div>

                            <!-- 3. Follow -->
                            <div>
                                <label for="follow_points" class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                    <i class="fas fa-user-plus text-purple-600"></i> ‡¶´‡¶≤‡ßã ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü (follow):
                                </label>
                                <input type="number" id="follow_points" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500" placeholder="‡¶´‡¶≤‡ßã ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü">
                            </div>

                            <!-- 4. Share -->
                            <div>
                                <label for="share_points" class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                    <i class="fas fa-share-alt text-cyan-600"></i> ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü (share):
                                </label>
                                <input type="number" id="share_points" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500" placeholder="‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü">
                            </div>

                            <!-- 5. Group Join -->
                            <div>
                                <label for="group_join_points" class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                    <i class="fas fa-users text-teal-600"></i> ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶ú‡¶Ø‡¶º‡ßá‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü (groupJoin):
                                </label>
                                <input type="number" id="group_join_points" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500" placeholder="‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶ú‡¶Ø‡¶º‡ßá‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü">
                            </div>

                        </div>

                        <button id="saveProductPointsBtn" class="w-full bg-yellow-600 text-white py-3 rounded-lg font-bold hover:bg-yellow-700 transition duration-200">
                            <i class="fas fa-save mr-2"></i> ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>
                        <p id="product-status" class="text-center text-sm mt-2 text-gray-500 hidden"></p>
                    </div>
                </div>
            </div>
            <!-- ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶∂‡ßá‡¶∑ -->

        </div>
    </div>
    
    <!-- ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∂‡¶® ‡¶Æ‡¶°‡¶æ‡¶≤ (Updated for Rejection Reason and Report Reward) -->
    <div id="admin-modal" class="custom-modal">
        <div class="custom-modal-content">
            <h3 class="text-xl font-bold mb-2 text-gray-800" id="modal-title">‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            <p class="text-gray-600 mb-4" id="modal-message"></p>
            
            <!-- ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶á‡¶®‡¶™‡ßÅ‡¶ü (‡¶™‡ßç‡¶∞‡ßÅ‡¶´/‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶â‡¶≠‡¶Ø‡¶º‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø) -->
            <div id="review-comment-group" class="mb-4 hidden text-left">
                <label for="review-comment" class="block text-sm font-medium text-gray-700 mb-2" id="review-comment-label">‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø/‡¶ï‡¶æ‡¶∞‡¶£:</label>
                <textarea id="review-comment" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø/‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
            </div>
            
            <!-- ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞‡ßá‡¶∞ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶á‡¶®‡¶™‡ßÅ‡¶ü (‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø) -->
            <div id="reward-points-group" class="mb-4 hidden text-left">
                <label for="reward-points" class="block text-sm font-medium text-gray-700 mb-2">‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü (‡ß´‡ß¶-‡ß´‡ß¶‡ß¶):</label>
                <input type="number" id="reward-points" min="50" max="500" value="100" class="w-full p-3 border border-green-300 rounded-lg focus:ring-green-500 focus:border-green-500">
            </div>

            <!-- ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ -->
            <div id="suspension-group" class="mb-4 hidden text-left space-y-3">
                <p class="text-lg font-bold text-red-600 border-b pb-2">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                <div class="flex flex-col sm:flex-row gap-3">
                    <div class="flex-1">
                        <label for="suspend-duration" class="block text-sm font-medium text-gray-700 mb-1">‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÄ‡¶Æ‡¶æ:</label>
                        <select id="suspend-duration" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                            <option value="60">‡ßß ‡¶ò‡¶®‡ßç‡¶ü‡¶æ</option>
                            <option value="180">‡ß© ‡¶ò‡¶®‡ßç‡¶ü‡¶æ</option>
                            <option value="360">‡ß¨ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ</option>
                            <option value="720">‡ßß‡ß® ‡¶ò‡¶®‡ßç‡¶ü‡¶æ</option>
                            <option value="1440" selected>‡ßß ‡¶¶‡¶ø‡¶® (‡ß®‡ß™ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ)</option>
                            <option value="4320">‡ß© ‡¶¶‡¶ø‡¶®</option>
                            <option value="10080">‡ß≠ ‡¶¶‡¶ø‡¶®</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label for="suspend-reason" class="block text-sm font-medium text-gray-700 mb-1">‡¶ï‡¶æ‡¶∞‡¶£ (‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï):</label>
                        <textarea id="suspend-reason" rows="3" class="w-full p-3 border border-red-300 rounded-lg focus:ring-red-500 focus:border-red-500" placeholder="‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
                    </div>
                </div>
            </div>
            
            <div class="custom-modal-actions">
                <button class="custom-modal-btn bg-red-500 text-white hover:bg-red-600" id="modal-confirm-btn">
                    ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®
                </button>
                <button class="custom-modal-btn bg-gray-200 text-gray-800 hover:bg-gray-300" onclick="closeAdminModal()">
                    ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤
                </button>
            </div>
        </div>
    </div>

    <div id="notification-container"></div>
    
    <script type="module">
        // Firebase imports from rtdb-config.js
        import { rtdb, ref, onValue, set, update, remove, get, auth, showNotification, runTransaction } from './rtdb-config.js'; 
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js"; 

        // Get references to the DOM elements
        const usersTableBody = document.querySelector('#users table tbody');
        const tasksTableBody = document.querySelector('#tasks table tbody');
        const proofsGrid = document.getElementById('proofs-grid');
        const reportsGrid = document.getElementById('reports-grid'); 
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        const adminModal = document.getElementById('admin-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        
        // ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶á‡¶®‡¶™‡ßÅ‡¶ü
        const reviewCommentGroup = document.getElementById('review-comment-group');
        const reviewCommentInput = document.getElementById('review-comment');
        const reviewCommentLabel = document.getElementById('review-comment-label');
        
        const rewardPointsGroup = document.getElementById('reward-points-group');
        const rewardPointsInput = document.getElementById('reward-points');

        // ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü
        const suspensionGroup = document.getElementById('suspension-group');
        const suspendDurationInput = document.getElementById('suspend-duration');
        const suspendReasonInput = document.getElementById('suspend-reason');
        
        // üî• ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü (Referral)
        const referredBonusInput = document.getElementById('referredBonus');
        const refereeBonusInput = document.getElementById('refereeBonus');
        const saveReferralSettingsBtn = document.getElementById('saveReferralSettingsBtn');
        const referralStatus = document.getElementById('referral-status');

        // üî• ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü (Task Points)
        const reactPointsInput = document.getElementById('react_points');
        const commentPointsInput = document.getElementById('comment_points');
        const followPointsInput = document.getElementById('follow_points');
        const sharePointsInput = document.getElementById('share_points');
        const groupJoinPointsInput = document.getElementById('group_join_points');
        const saveProductPointsBtn = document.getElementById('saveProductPointsBtn');
        const productStatus = document.getElementById('product-status');


        let currentUserId = null;
        let pendingAction = { actionType: null, data: null };
        let allUsersData = {};

        // Modal functions
        window.closeAdminModal = () => {
            adminModal.style.display = 'none';
            pendingAction = { actionType: null, data: null }; // ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
            reviewCommentInput.value = ''; // ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ
            rewardPointsInput.value = '100'; // ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ
            suspendReasonInput.value = ''; // ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶ï‡ßç‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ
        };
        
        const openAdminModal = (type, data) => {
            pendingAction.actionType = type;
            pendingAction.data = data;
            
            let titleText = '‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®';
            let messageText = '';
            let confirmClass = '';
            
            // ‡¶∏‡¶¨ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶π‡¶æ‡¶á‡¶° ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            reviewCommentGroup.classList.add('hidden');
            rewardPointsGroup.classList.add('hidden'); 
            suspensionGroup.classList.add('hidden'); // ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶π‡¶æ‡¶á‡¶°
            reviewCommentInput.classList.remove('border-red-500', 'focus:ring-red-500', 'focus:border-red-500'); 
            reviewCommentInput.classList.add('border-gray-300', 'focus:ring-blue-500', 'focus:border-blue-500');

            if (type === 'closeTask') {
                titleText = '‡¶ï‡¶æ‡¶ú ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®';
                messageText = `‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ID ${data.taskId.substring(0, 8)}... ‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`;
                confirmClass = 'bg-red-500 hover:bg-red-600';
            } else if (type === 'approveProof') {
                titleText = '‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶® ‡¶¶‡¶ø‡¶®';
                messageText = `‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡ßÅ‡¶´‡¶ü‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶® ‡¶ï‡¶∞‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ${(data.points).toLocaleString('bn-BD')} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡¶ø‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`;
                confirmClass = 'bg-green-500 hover:bg-green-600';
            } else if (type === 'rejectProof') {
                titleText = '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®';
                messageText = `‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡ßÅ‡¶´‡¶ü‡¶ø ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®? ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡•§ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶â‡¶≤‡ßç‡¶≤‡ßá‡¶ñ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`;
                confirmClass = 'bg-red-500 hover:bg-red-600';
                reviewCommentGroup.classList.remove('hidden'); // ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                reviewCommentLabel.textContent = '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ (‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï):';
                reviewCommentInput.value = ''; 
                reviewCommentInput.classList.remove('border-gray-300', 'focus:ring-blue-500', 'focus:border-blue-500');
                reviewCommentInput.classList.add('border-red-500', 'focus:ring-red-500', 'focus:border-red-500'); // ‡¶≤‡¶æ‡¶≤ ‡¶¨‡¶∞‡ßç‡¶°‡¶æ‡¶∞
            } else if (type === 'approveReport') { 
                titleText = '‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®';
                messageText = `‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ${data.userName} ‡¶ï‡ßá ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡¶ø‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶ü‡¶ø: "${data.title}"`;
                confirmClass = 'bg-green-500 hover:bg-green-600';
                rewardPointsGroup.classList.remove('hidden'); // ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                reviewCommentGroup.classList.remove('hidden'); // ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                reviewCommentLabel.textContent = '‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï):';
                reviewCommentInput.placeholder = '‡¶è‡¶á ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...';
                reviewCommentInput.value = ''; 
                rewardPointsInput.value = '100'; 
            } else if (type === 'rejectReport') { 
                titleText = '‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®';
                messageText = `‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶ü‡¶ø ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®? ‡¶è‡¶ü‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶â‡¶≤‡ßç‡¶≤‡ßá‡¶ñ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`;
                confirmClass = 'bg-red-500 hover:bg-red-600';
                reviewCommentGroup.classList.remove('hidden'); // ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                reviewCommentLabel.textContent = '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ (‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï):';
                reviewCommentInput.value = ''; 
                reviewCommentInput.classList.remove('border-gray-300', 'focus:ring-blue-500', 'focus:border-blue-500');
                reviewCommentInput.classList.add('border-red-500', 'focus:ring-red-500', 'focus:border-red-500'); // ‡¶≤‡¶æ‡¶≤ ‡¶¨‡¶∞‡ßç‡¶°‡¶æ‡¶∞
            } else if (type === 'suspendUser') { // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶°
                titleText = '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®';
                messageText = `‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID ${data.userId.substring(0, 8)}... ‡¶ï‡ßá ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`;
                confirmClass = 'bg-red-500 hover:bg-red-600';
                suspensionGroup.classList.remove('hidden'); // ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                suspendDurationInput.value = '1440'; // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡ßß ‡¶¶‡¶ø‡¶®
                suspendReasonInput.value = '';
            } else if (type === 'unsuspendUser') { // üî• ‡¶®‡¶§‡ßÅ‡¶®: ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡¶®
                titleText = '‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶π‡¶æ‡¶∞';
                messageText = `‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID ${data.userId.substring(0, 8)}... ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`;
                confirmClass = 'bg-green-500 hover:bg-green-600';
            }


            // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
            modalConfirmBtn.classList.remove('bg-red-500', 'bg-green-500', 'bg-yellow-500', 'hover:bg-red-600', 'hover:bg-green-600', 'hover:bg-yellow-600');
            const classArray = confirmClass.split(' ');
            modalConfirmBtn.classList.add(...classArray);
            
            modalTitle.textContent = titleText;
            modalMessage.textContent = messageText;
            modalConfirmBtn.className = `custom-modal-btn text-white font-bold ${confirmClass}`;
            adminModal.style.display = 'flex';
        };

        // ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶æ‡¶∞
        modalConfirmBtn.onclick = () => {
            const { actionType, data } = pendingAction;
            
            if (!currentUserId) {
                showNotification('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'error');
                return;
            }
            
            // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶≤‡¶ú‡¶ø‡¶ï
            if (actionType === 'suspendUser') {
                const durationMinutes = parseInt(suspendDurationInput.value);
                const reason = suspendReasonInput.value.trim();
                
                if (isNaN(durationMinutes) || durationMinutes <= 0) {
                    showNotification('‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶®‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'error');
                    return;
                }
                if (!reason) {
                    showNotification('‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶≤‡ßá‡¶ñ‡¶æ ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï‡•§', 'error');
                    return;
                }
                window.handleManualSuspension(data.userId, durationMinutes, reason);
            }
            
            // üî• ‡¶®‡¶§‡ßÅ‡¶®: ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡¶®
            else if (actionType === 'unsuspendUser') {
                window.handleUnsuspendUser(data.userId);
            }
            
            // ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶¨‡¶æ‡¶ß‡ßç‡¶Ø‡¶§‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï
            else if (actionType === 'rejectProof') {
                 const rejectionReason = reviewCommentInput.value.trim();
                 if (!rejectionReason) {
                     showNotification('‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶â‡¶≤‡ßç‡¶≤‡ßá‡¶ñ ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï‡•§', 'error');
                     return;
                 }
                 window.handleRejectProof(data.taskId, data.proofId, data.userId, rejectionReason);
            } 
            
            // ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≤‡¶ú‡¶ø‡¶ï
            else if (actionType === 'approveReport') {
                const rewardPoints = parseInt(rewardPointsInput.value);
                const reviewComment = reviewCommentInput.value.trim(); 
                if (isNaN(rewardPoints) || rewardPoints < 50 || rewardPoints > 500) {
                    showNotification('‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡ß´‡ß¶ ‡¶•‡ßá‡¶ï‡ßá ‡ß´‡ß¶‡ß¶ ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§', 'error');
                    return;
                }
                window.handleApproveReport(data.reportId, data.userId, rewardPoints, reviewComment);
            }
            
            // ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≤‡¶ú‡¶ø‡¶ï (‡¶ï‡¶æ‡¶∞‡¶£ ‡¶¨‡¶æ‡¶ß‡ßç‡¶Ø‡¶§‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï)
            else if (actionType === 'rejectReport') {
                const reviewComment = reviewCommentInput.value.trim();
                if (!reviewComment) {
                     showNotification('‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶â‡¶≤‡ßç‡¶≤‡ßá‡¶ñ ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï‡•§', 'error');
                     return;
                }
                window.handleRejectReport(data.reportId, reviewComment);
            }
            
            else if (actionType === 'closeTask') {
                window.handleCloseTask(data.taskId);
            } else if (actionType === 'approveProof') {
                window.handleApproveProof(data.taskId, data.proofId, data.userId, data.points); 
            }
            
            closeAdminModal(); // ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ 
        };

        window.onclick = function(event) {
            if (event.target === adminModal) {
                closeAdminModal();
            }
        };

        // End Modal functions

        /**
         * ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶∞‡ßã‡¶≤ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶® ‡¶®‡¶æ ‡¶™‡ßá‡¶≤‡ßá ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡•§
         * @param {string} userId - ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ UID
         */
        const checkAdminRole = (userId) => {
             const userRef = ref(rtdb, `users/${userId}/role`);
             onValue(userRef, (snapshot) => {
                 const role = snapshot.val();
                 if (role !== 'admin') {
                     showNotification("‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶®‡ßá‡¶á! ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶è‡¶°‡¶Æ‡¶ø‡¶®‡¶∞‡¶æ‡¶á ‡¶è‡¶á ‡¶™‡ßá‡¶ú‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§", 'error');
                     // ‡¶Ö‡¶®‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶™‡¶æ‡¶†‡¶ø‡¶Ø‡¶º‡ßá ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ
                     setTimeout(() => { window.location.href = 'index.html'; }, 1500);
                 } else {
                    // ‡¶Ø‡¶¶‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
                    startDataListeners();
                 }
             }, { onlyOnce: true });
        };
        
        // AUTH CHECK - Ensures user is logged in
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUserId = user.uid;
                checkAdminRole(currentUserId);
            } else {
                window.location.href = 'login.html';
            }
        });

        const startDataListeners = () => {
            // Listen for users data and cache it
            onValue(ref(rtdb, 'users'), (snapshot) => {
                const users = snapshot.val() || {};
                allUsersData = users; // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                renderUsers(users); 
            });

            // Listen for tasks data
            onValue(ref(rtdb, 'tasks'), (snapshot) => {
                const tasks = snapshot.val() || {};
                renderTasks(tasks);
                renderProofs(tasks); 
            });
            
            // ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡¶ø‡¶∏‡ßá‡¶® ‡¶ï‡¶∞‡¶æ
            onValue(ref(rtdb, 'reports'), (snapshot) => {
                const reports = snapshot.val() || {};
                renderReports(reports); 
            });
            
            // ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶≤‡¶ø‡¶∏‡ßá‡¶® ‡¶ï‡¶∞‡¶æ
            loadControlSettings(); 
        };
        
        // üî• ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        const loadControlSettings = () => {
            // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
            const referralRef = ref(rtdb, 'controls/referralBonus');
            onValue(referralRef, (snapshot) => {
                const controlData = snapshot.val() || {};
                
                referredBonusInput.value = controlData.referredUser || 0;
                refereeBonusInput.value = controlData.refereeUser || 0;
                
                referralStatus.textContent = `‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: ${new Date().toLocaleTimeString('bn-BD')}`;
                referralStatus.classList.remove('hidden');
            });
            
            // üî• ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
            const productRef = ref(rtdb, 'controls/productPoints');
            onValue(productRef, (snapshot) => {
                const productData = snapshot.val() || {};
                
                // ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                reactPointsInput.value = productData.react || 0;
                commentPointsInput.value = productData.comment || 0;
                followPointsInput.value = productData.follow || 0;
                sharePointsInput.value = productData.share || 0;
                groupJoinPointsInput.value = productData.groupJoin || 0;
                
                productStatus.textContent = `‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: ${new Date().toLocaleTimeString('bn-BD')}`;
                productStatus.classList.remove('hidden');
            });
        };

        // üî• ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        const handleSaveReferralSettings = async () => {
            const referredValue = parseInt(referredBonusInput.value) || 0;
            const refereeValue = parseInt(refereeBonusInput.value) || 0;
            
            if (referredValue < 0 || refereeValue < 0) {
                showNotification('‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶® ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶∂‡ßÇ‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ ‡¶§‡¶æ‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§', 'error');
                return;
            }
            
            if (!currentUserId) {
                showNotification('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'error');
                return;
            }
            
            showNotification('‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            const controlRef = ref(rtdb, 'controls/referralBonus');
            
            try {
                await update(controlRef, {
                    referredUser: referredValue,
                    refereeUser: refereeValue,
                    lastUpdatedBy: currentUserId,
                    lastUpdatedAt: Date.now()
                });
                
                showNotification('‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'success', 5000);
            } catch (error) {
                console.error("Error saving referral settings:", error);
                showNotification('‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§', 'error');
            }
        };

        // üî• ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        const handleSaveProductPoints = async () => {
            const reactValue = parseInt(reactPointsInput.value) || 0;
            const commentValue = parseInt(commentPointsInput.value) || 0;
            const followValue = parseInt(followPointsInput.value) || 0;
            const shareValue = parseInt(sharePointsInput.value) || 0;
            const groupJoinValue = parseInt(groupJoinPointsInput.value) || 0;
            
            if (reactValue < 0 || commentValue < 0 || followValue < 0 || shareValue < 0 || groupJoinValue < 0) {
                showNotification('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶® ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶∂‡ßÇ‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ ‡¶§‡¶æ‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§', 'error');
                return;
            }
            
            if (!currentUserId) {
                showNotification('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'error');
                return;
            }
            
            showNotification('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            const productPointsRef = ref(rtdb, 'controls/productPoints');
            
            try {
                await update(productPointsRef, {
                    react: reactValue,
                    comment: commentValue,
                    follow: followValue,
                    share: shareValue,
                    groupJoin: groupJoinValue, // ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßÄ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá
                    lastUpdatedBy: currentUserId,
                    lastUpdatedAt: Date.now()
                });
                
                showNotification('‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'success', 5000);
            } catch (error) {
                console.error("Error saving product points:", error);
                showNotification('‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§', 'error');
            }
        };


        // Function to render users table
        const renderUsers = (users) => {
            usersTableBody.innerHTML = '';
            for (const userId in users) {
                const user = users[userId];
                
                // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶¨‡¶æ ‡¶Æ‡¶°‡¶æ‡¶∞‡ßá‡¶ü‡¶∞‡¶¶‡ßá‡¶∞ ‡¶®‡¶ø‡¶ú‡ßá‡¶¶‡ßá‡¶∞ ‡¶∞‡ßã‡¶≤‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶¶‡ßá‡¶¨‡ßá ‡¶®‡¶æ
                if (userId === currentUserId && (user.role === 'admin' || user.role === 'moderator')) {
                    continue; 
                }
                
                const row = document.createElement('tr');
                const displayName = user.facebookName || 'N/A';
                const isVerified = user.isVerified || false;
                const userRole = user.role || 'user';
                const isSuspended = user.suspension?.suspended && user.suspension.suspendUntil > Date.now();
                
                const suspensionBadge = isSuspended 
                    ? `<span class="px-2 py-1 rounded-full text-xs font-semibold bg-red-500 text-white ml-2">‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶°</span>`
                    : '';
                
                // ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶ü‡¶ó‡¶≤ ‡¶¨‡¶æ‡¶ü‡¶®
                const verificationButton = `
                    <button class="px-3 py-1 rounded-full text-xs font-bold text-white transition-colors duration-200 ${isVerified ? 'bg-red-500 hover:bg-red-600' : 'brand-blue hover:brightness-110'}" onclick="toggleVerification('${userId}', ${isVerified})">
                        <i class="fas ${isVerified ? 'fa-ban' : 'fa-user-check'} mr-1"></i>
                        ${isVerified ? '‡¶∏‡¶∞‡¶æ‡¶®' : '‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á'}
                    </button>
                `;
                
                // üî• ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶°/‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡¶¶ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®
                let suspensionActionHtml = '';
                if (isSuspended) {
                    // ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡¶¶ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® (Unsuspend)
                    suspensionActionHtml = `
                        <button class="px-3 py-1 rounded-full text-xs font-bold text-white transition-colors duration-200 bg-green-500 hover:bg-green-600" onclick="openAdminModal('unsuspendUser', { userId: '${userId}', userName: '${displayName}' })">
                            <i class="fas fa-undo mr-1"></i> ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡¶®
                        </button>
                    `;
                } else {
                    // ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡¶ü‡¶® (Suspend)
                    suspensionActionHtml = `
                        <button class="px-3 py-1 rounded-full text-xs font-bold text-white transition-colors duration-200 bg-red-600 hover:bg-red-700" onclick="openAdminModal('suspendUser', { userId: '${userId}', userName: '${displayName}' })">
                            <i class="fas fa-gavel mr-1"></i> ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶°
                        </button>
                    `;
                }
                
                row.innerHTML = `
                    <td class="text-sm text-gray-500 font-mono break-all">${userId.substring(0, 10)}...</td>
                    <td class="font-medium text-gray-800">${displayName} ${suspensionBadge}</td>
                    <td class="font-semibold text-green-600">${(user.points || 0).toLocaleString('bn-BD')}</td>
                    <td>
                        <span class="px-2 py-1 rounded-full text-xs font-semibold ${isVerified ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                            ${isVerified ? '‡¶π‡ßç‡¶Ø‡¶æ‡¶Å' : '‡¶®‡¶æ'}
                        </span>
                    </td>
                    <td>
                        <span class="px-2 py-1 rounded-full text-xs font-semibold bg-indigo-100 text-indigo-700">
                            ${userRole}
                        </span>
                    </td>
                    <td class="space-x-2">
                        ${verificationButton}
                        ${suspensionActionHtml} 
                    </td>
                `;
                usersTableBody.appendChild(row);
            }
        };

        // Function to render tasks table (No change in existing logic)
        const renderTasks = (tasks) => {
            tasksTableBody.innerHTML = '';
            const sortedTasks = Object.keys(tasks).map(key => ({ id: key, ...tasks[key] })).sort((a, b) => b.createdAt - a.createdAt);

            sortedTasks.forEach((task) => {
                const row = document.createElement('tr');
                const taskStatus = task.status || 'N/A';
                const statusColor = taskStatus === 'active' ? 'text-green-600' : 'text-red-600';

                row.innerHTML = `
                    <td class="text-sm text-gray-500 font-mono break-all">${task.id.substring(0, 10)}...</td>
                    <td class="font-medium">${task.taskType || 'N/A'}</td>
                    <td><a href="${task.taskLink}" target="_blank" class="brand-blue-text hover:underline">${task.taskLink ? task.taskLink.substring(0, 30) + '...' : 'N/A'}</a></td>
                    <td class="font-semibold text-yellow-600">${(task.pointsPerTask || 0).toLocaleString('bn-BD')}</td>
                    <td class="font-medium ${statusColor}">${taskStatus === 'active' ? '‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º' : '‡¶¨‡¶®‡ßç‡¶ß'}</td>
                    <td>
                        ${taskStatus === 'active' ? 
                            `<button class="px-4 py-2 rounded-full text-sm font-bold text-white transition-colors duration-200 bg-red-500 hover:bg-red-600" onclick="openAdminModal('closeTask', { taskId: '${task.id}' })">
                                <i class="fas fa-times-circle mr-2"></i> ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>`
                        : `<span class="text-gray-500 text-sm italic">‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶¨‡¶®‡ßç‡¶ß</span>`}
                    </td>
                `;
                tasksTableBody.appendChild(row);
            });
        };

        // Function to render proofs (No change in existing logic)
        const renderProofs = (tasks) => {
            proofsGrid.innerHTML = '';
            let proofsFound = false;
            
            const proofsToRender = [];

            for (const taskId in tasks) {
                const task = tasks[taskId];
                if (task.proofs) {
                    for (const proofId in task.proofs) {
                        const proof = task.proofs[proofId];
                        
                        if (proof.status === 'pending') {
                            proofsFound = true;
                            // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶ï‡¶∞‡¶æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                            const userData = allUsersData[proof.userId] || {};
                            
                            proofsToRender.push({ taskId, proofId, task, proof, userData });
                        }
                    }
                }
            }
            
            // ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶≤‡¶ú‡¶ø‡¶ï
            proofsToRender.forEach(({ taskId, proofId, task, proof, userData }) => {
                // ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá userData, ‡¶Ø‡¶¶‡¶ø ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶¨‡ßá proof ‡¶•‡ßá‡¶ï‡ßá facebookName ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
                const userDisplayName = userData.facebookName || proof.facebookName || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ';
                const taskIconClass = getTaskTypeIcon(task.taskType);
                
                // ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá
                let proofDataHtml = '';
                if (proof.screenshotUrl) {
                    proofDataHtml = `
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <span class="font-medium text-gray-700 block mb-2"><i class="fas fa-image text-green-500 mr-2"></i> ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶™‡ßç‡¶∞‡ßÅ‡¶´:</span>
                            <img src="${proof.screenshotUrl}" alt="‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶™‡ßç‡¶∞‡ßÅ‡¶´" 
                                 class="w-full h-auto max-h-48 object-contain rounded-lg border border-gray-200 cursor-pointer"
                                 onclick="window.open('${proof.screenshotUrl}', '_blank')" />
                        </div>`;
                } else if (proof.facebookLink) { 
                    // ‡¶Ø‡¶¶‡¶ø ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶°‡ßá‡¶ü‡¶æ ‡¶•‡¶æ‡¶ï‡ßá (facebookLink), ‡¶∏‡ßá‡¶ü‡¶æ‡¶ì ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã
                    proofDataHtml = `
                        <p class="text-sm">
                            <span class="font-medium text-gray-700">‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶≤‡¶ø‡¶Ç‡¶ï (‡¶™‡ßÅ‡¶∞‡ßã‡¶®‡ßã):</span> 
                            <a href="${proof.facebookLink}" target="_blank" class="brand-blue-text hover:underline break-all">${proof.facebookLink}</a>
                        </p>`;
                }
                
                const proofCard = `
                    <div class="app-card p-5">
                        <div class="flex items-center justify-between mb-4 pb-4 border-b">
                            <div class="flex items-center gap-3">
                                <i class="fas ${taskIconClass} text-2xl"></i>
                                <div>
                                    <h4 class="font-semibold text-gray-800">${userDisplayName}</h4>
                                    <p class="text-sm text-gray-500 font-mono break-all">
                                        ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø: ${proof.userId.substring(0, 10)}...
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-3 mb-6">
                            <p class="text-sm">
                                <span class="font-medium text-gray-700">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞:</span> 
                                <span class="font-semibold text-gray-900">${task.taskType}</span>
                            </p>
                            <p class="text-sm">
                                <span class="font-medium text-gray-700">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶≤‡¶ø‡¶Ç‡¶ï:</span> 
                                <a href="${task.taskLink}" target="_blank" class="brand-blue-text hover:underline break-all">${task.taskLink}</a>
                            </p>
                            <p class="text-sm">
                                <span class="font-medium text-gray-700">‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü:</span> 
                                <span class="font-semibold text-green-600">+${(task.pointsPerTask).toLocaleString('bn-BD')}</span>
                            </p>
                            ${proofDataHtml} 
                        </div>
                        <div class="flex gap-4">
                            <button class="flex-1 brand-blue text-white py-2.5 rounded-lg font-bold hover:brightness-110 transition duration-200" onclick="openAdminModal('approveProof', { taskId: '${taskId}', proofId: '${proofId}', userId: '${proof.userId}', points: ${task.pointsPerTask} })">
                                <i class="fas fa-thumbs-up mr-2"></i> ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶®
                            </button>
                            <button class="flex-1 bg-red-500 text-white py-2.5 rounded-lg font-bold hover:bg-red-600 transition duration-200" onclick="openAdminModal('rejectProof', { taskId: '${taskId}', proofId: '${proofId}', userId: '${proof.userId}' })">
                                <i class="fas fa-times-circle mr-2"></i> ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤
                            </button>
                        </div>
                    </div>
                `;
                proofsGrid.insertAdjacentHTML('beforeend', proofCard);
            });
            
            if (!proofsFound) {
                proofsGrid.innerHTML = '<div class="col-span-full text-center py-12 text-gray-500 text-lg">üéâ ‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶®‡ßá‡¶á‡•§</div>';
            }
        };

        // Function to render reports (No change in existing logic)
        const renderReports = (reports) => {
            reportsGrid.innerHTML = '';
            let reportsFound = false;
            
            const reportsToRender = Object.keys(reports)
                .map(key => ({ id: key, ...reports[key] }))
                .filter(report => report.status === 'pending')
                .sort((a, b) => a.submittedAt - b.submittedAt); // ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶ó‡ßÅ‡¶≤‡ßã ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá

            reportsToRender.forEach((report) => {
                reportsFound = true;
                const typeColor = getReportTypeColor(report.type);
                const typeDisplay = getReportTypeDisplay(report.type);
                
                const reportCard = `
                    <div class="report-card app-card p-5 ${report.type}">
                        <div class="flex justify-between items-center mb-4 pb-3 border-b border-gray-100">
                            <span class="px-3 py-1 text-xs font-bold rounded-full text-white ${typeColor}">
                                ${typeDisplay}
                            </span>
                            <span class="text-xs text-gray-500">${new Date(report.submittedAt).toLocaleDateString('bn-BD')}</span>
                        </div>
                        <h4 class="text-lg font-bold text-gray-800 mb-2">${report.title}</h4>
                        <p class="text-sm text-gray-600 mb-4">${report.details}</p>

                        <div class="space-y-1 text-sm text-gray-700 mb-4">
                            <p><strong>‡¶á‡¶â‡¶ú‡¶æ‡¶∞:</strong> ${report.userName || 'N/A'}</p>
                            <p class="text-xs"><strong>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID:</strong> ${report.userId.substring(0, 10)}...</p>
                            ${report.screenshotUrl ? 
                                `<a href="${report.screenshotUrl}" target="_blank" class="brand-blue-text hover:underline text-xs block mt-1">
                                    <i class="fas fa-image mr-1"></i> ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                                </a>`
                            : ''}
                        </div>
                        
                        <div class="flex gap-3">
                            <button class="flex-1 bg-green-500 text-white font-bold py-2.5 rounded-lg hover:bg-green-600 transition" 
                                onclick="openAdminModal('approveReport', { reportId: '${report.id}', userId: '${report.userId}', userName: '${report.userName || 'N/A'}', title: '${report.title}' })">
                                <i class="fas fa-check-circle mr-2"></i> ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶®
                            </button>
                            <button class="flex-1 bg-red-500 text-white font-bold py-2.5 rounded-lg hover:bg-red-600 transition" 
                                onclick="openAdminModal('rejectReport', { reportId: '${report.id}' })">
                                <i class="fas fa-times-circle mr-2"></i> ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤
                            </button>
                        </div>
                    </div>
                `;
                reportsGrid.insertAdjacentHTML('beforeend', reportCard);
            });

            if (!reportsFound) {
                reportsGrid.innerHTML = '<div class="col-span-full text-center py-12 text-gray-500 text-lg">‚úÖ ‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§</div>';
            }
        };
        
        /**
         * ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∞‡¶≠‡ßá‡¶¶‡ßá‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶á‡¶ï‡¶® ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßá‡•§
         */
        const getTaskTypeIcon = (type) => {
            switch(type.toLowerCase()) {
                case 'react': return 'fa-thumbs-up text-blue-600';
                case 'comment': return 'fa-comment text-indigo-600';
                case 'share': return 'fa-share text-cyan-600';
                case 'follow': return 'fa-user-plus text-purple-600';
                case 'group': return 'fa-users text-teal-600'; 
                default: return 'fa-list-check text-gray-600';
            }
        };
        
        /**
         * ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ü‡¶æ‡¶á‡¶™‡ßá‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø ‡¶ï‡¶∞‡ßá ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßá‡•§
         */
        const getReportTypeColor = (type) => {
            switch(type.toLowerCase()) {
                case 'bug': return 'bg-red-500';
                case 'suggestion': return 'bg-blue-500';
                case 'security': return 'bg-green-500';
                default: return 'bg-gray-500';
            }
        };
        
        /**
         * ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ü‡¶æ‡¶á‡¶™‡ßá‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø ‡¶ï‡¶∞‡ßá ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßá‡•§
         */
        const getReportTypeDisplay = (type) => {
            switch(type.toLowerCase()) {
                case 'bug': return '‡¶¨‡¶æ‡¶ó/‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø';
                case 'suggestion': return '‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂';
                case 'security': return '‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ';
                default: return '‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø';
            }
        };

        // ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶æ‡¶∞
        window.handleManualSuspension = async (uId, durationMinutes, reasonMessage) => {
            showNotification(`‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID ${uId.substring(0, 8)}... ‡¶ï‡ßá ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ö‡¶≤‡¶õ‡ßá...`, 'info', 3000);
            
            const suspendUntil = Date.now() + (durationMinutes * 60 * 1000); // ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶®‡ßá‡¶∞ ‡¶∂‡ßá‡¶∑ ‡¶∏‡¶Æ‡¶Ø‡¶º
            
            try {
                const suspensionRef = ref(rtdb, `users/${uId}/suspension`);
                
                await set(suspensionRef, {
                    suspended: true,
                    suspendUntil: suspendUntil,
                    reason: reasonMessage,
                    issuedBy: currentUserId, // ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
                    issuedAt: Date.now()
                });
                
                showNotification(`‡¶∏‡¶´‡¶≤! ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ${durationMinutes} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`, 'success', 8000);

            } catch (error) {
                console.error("Error setting manual suspension data:", error);
                showNotification('‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú‡ßá ‡¶≤‡¶ø‡¶ñ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§', 'error');
            }
        };

        // üî• ‡¶®‡¶§‡ßÅ‡¶®: ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶æ‡¶∞
        window.handleUnsuspendUser = async (uId) => {
            showNotification(`‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID ${uId.substring(0, 8)}... ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ö‡¶≤‡¶õ‡ßá...`, 'info', 3000);
            
            try {
                const suspensionRef = ref(rtdb, `users/${uId}/suspension`);
                
                // ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                await update(suspensionRef, {
                    suspended: false,
                    suspendUntil: 0,
                    reason: null, // ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ
                    revokedBy: currentUserId, // ‡¶ï‡ßá ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá ‡¶§‡¶æ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡¶≤‡ßã
                    revokedAt: Date.now() // ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º
                });
                
                showNotification(`‡¶∏‡¶´‡¶≤! ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID ${uId.substring(0, 8)}... ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`, 'success', 8000);

            } catch (error) {
                console.error("Error revoking suspension data:", error);
                showNotification('‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶ú‡ßá ‡¶≤‡¶ø‡¶ñ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§', 'error');
            }
        };


        // ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø‡¶∏‡¶π) (Existing logic - no change)
        window.handleApproveReport = async (reportId, userIdToReward, rewardPoints, reviewComment) => {
            showNotification(`‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ID ${reportId.substring(0, 8)}... ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ö‡¶≤‡¶õ‡ßá...`, 'info');
            
            const reportRef = ref(rtdb, `reports/${reportId}`);
            const userRef = ref(rtdb, `users/${userIdToReward}`);

            try {
                // ‡ßß. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ (‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá)
                const userUpdateResult = await runTransaction(userRef, (currentData) => {
                    if (currentData) {
                        currentData.points = (currentData.points || 0) + rewardPoints;
                        currentData.reportsApproved = (currentData.reportsApproved || 0) + 1;
                    }
                    return currentData;
                });

                if (!userUpdateResult.committed) {
                    throw new Error("User point update transaction failed.");
                }

                // ‡ß®. ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ (‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø‡¶∏‡¶π)
                await update(reportRef, {
                    status: 'approved',
                    rewardPoints: rewardPoints,
                    reviewedBy: currentUserId,
                    reviewedAt: Date.now(),
                    reviewComment: reviewComment // ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£
                });

                showNotification(`‡¶∏‡¶´‡¶≤! ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ${rewardPoints} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‡¶è‡¶¨‡¶Ç ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶ü‡¶ø ‡¶Ü‡¶∞‡ßç‡¶ï‡¶æ‡¶á‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`, 'success');

            } catch (error) {
                console.error("Error rewarding report:", error);
                showNotification(`‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${error.message || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø'}‡•§`, 'error');
            }
        };
        
        // ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø‡¶∏‡¶π) (Existing logic - no change)
        window.handleRejectReport = async (reportId, reviewComment) => {
            showNotification(`‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ID ${reportId.substring(0, 8)}... ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ö‡¶≤‡¶õ‡ßá...`, 'info');
            
            const reportRef = ref(rtdb, `reports/${reportId}`);

            try {
                // ‡ßß. ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ (‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡¶∏‡¶π)
                await update(reportRef, {
                    status: 'rejected',
                    reviewedBy: currentUserId,
                    reviewedAt: Date.now(),
                    reviewComment: reviewComment, // ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£
                    rewardPoints: 0 
                });

                showNotification(`‡¶∏‡¶´‡¶≤! ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ID ${reportId.substring(0, 8)}... ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`, 'success');

            } catch (error) {
                console.error("Error rejecting report:", error);
                showNotification(`‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${error.message || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø'}‡•§`, 'error');
            }
        };


        // Global functions for button actions (Existing logic - no change)
        window.toggleVerification = (userId, isVerified) => {
            const userRef = ref(rtdb, `users/${userId}`);
            update(userRef, { isVerified: !isVerified })
                .then(() => showNotification('‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'info'))
                .catch(error => showNotification('‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§', 'error'));
        };

        window.handleCloseTask = (taskId) => {
            showNotification("‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ö‡¶≤‡¶õ‡ßá...", 'info');
            const taskRef = ref(rtdb, `tasks/${taskId}`);
            update(taskRef, { status: 'closed' })
                .then(() => showNotification('‡¶ï‡¶æ‡¶ú ‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'success'))
                .catch(error => showNotification('‡¶ï‡¶æ‡¶ú ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§', 'error'));
        };
        
        // handleApproveProof - trustScore ‡ß¶-‡ßß‡ß¶‡ß¶ ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶∏‡ßÄ‡¶Æ‡¶æ‡¶¨‡¶¶‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá (Existing logic - no change)
        window.handleApproveProof = async (taskId, proofId, userId, pointsToAdd) => {
            showNotification("‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶® ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ö‡¶≤‡¶õ‡ßá...", 'info');
            
            const APPROVE_trust_CHANGE = 5; // ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø +5
            
            if (!currentUserId) {
                showNotification('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§', 'error');
                return;
            }
            
            const proofRef = ref(rtdb, `tasks/${taskId}/proofs/${proofId}`);
            const userRef = ref(rtdb, `users/${userId}`);
            const taskRef = ref(rtdb, `tasks/${taskId}`);
            
            try {
                const snapshot = await get(proofRef);
                const currentProof = snapshot.val();
                if (!currentProof || currentProof.status !== 'pending') {
                    showNotification('‡¶è‡¶á ‡¶™‡ßç‡¶∞‡ßÅ‡¶´‡¶ü‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡¶á ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'error');
                    return;
                }

                await update(proofRef, { status: 'approved', reviewedBy: currentUserId, reviewedAt: Date.now() });
                
                const userUpdatePromise = runTransaction(userRef, (currentData) => {
                    if (currentData) {
                        const newPoints = (currentData.points || 0) + pointsToAdd;
                        const newTasksCompleted = (currentData.tasksCompleted || 0) + 1;
                        
                        // trust Score ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                        const newtrustScore = (currentData.trustScore || 0) + APPROVE_trust_CHANGE;
                        
                        currentData.points = newPoints;
                        currentData.tasksCompleted = newTasksCompleted;
                        // ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: trustScore ‡¶ï‡ßá ‡ß¶ ‡¶•‡ßá‡¶ï‡ßá ‡ßß‡ß¶‡ß¶ ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶∏‡ßÄ‡¶Æ‡¶æ‡¶¨‡¶¶‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
                        currentData.trustScore = Math.min(100, Math.max(0, newtrustScore)); 
                        currentData.completedTasks = currentData.completedTasks || {};
                        currentData.completedTasks[taskId] = 'approved'; 
                    }
                    return currentData;
                });
                
                const taskUpdatePromise = runTransaction(taskRef, (currentData) => {
                    if (currentData) {
                        currentData.completedCount = (currentData.completedCount || 0) + 1;
                        if (currentData.quantity && currentData.completedCount >= currentData.quantity) {
                            currentData.status = 'completed';
                        }
                    }
                    return currentData;
                });

                const [userResult, taskResult] = await Promise.all([userUpdatePromise, taskUpdatePromise]);
                
                if (userResult.committed && userResult.snapshot.val() && taskResult.committed) {
                    const finaltrustScore = userResult.snapshot.val().trustScore;
                    showNotification(`‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá (+${pointsToAdd} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü)‡•§ ‡¶®‡¶§‡ßÅ‡¶® trustScore: ${finaltrustScore}`, 'success');
                } else {
                     showNotification('‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶°‡ßá‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶¨‡¶ø‡¶ß‡¶ø ‡¶¨‡¶æ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§', 'error');
                }

            } catch (error) {
                console.error("Error approving proof:", error);
                showNotification(`‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${error.message || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø'}‡•§ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶¨‡¶ø‡¶ß‡¶ø ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`, 'error');
            }
        };

        // handleRejectProof - ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶è‡¶¨‡¶Ç trustScore (Existing logic - no change)
        window.handleRejectProof = async (taskId, proofId, userId, rejectionReason) => {
            showNotification("‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ö‡¶≤‡¶õ‡ßá...", 'info');
            
            const REJECT_trust_CHANGE = -10; // ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø -10
            
            if (!currentUserId) {
                showNotification('‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ü‡¶á‡¶°‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§', 'error');
                return;
            }
            
            const proofRef = ref(rtdb, `tasks/${taskId}/proofs/${proofId}`);
            const userRef = ref(rtdb, `users/${userId}`);
            
            try {
                const snapshot = await get(proofRef);
                const currentProof = snapshot.val();
                if (!currentProof || currentProof.status !== 'pending') {
                    showNotification('‡¶è‡¶á ‡¶™‡ßç‡¶∞‡ßÅ‡¶´‡¶ü‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡¶á ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'error');
                    return;
                }
                
                // ‡ßß. ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                await update(proofRef, { 
                    status: 'rejected', 
                    reviewedBy: currentUserId, 
                    reviewedAt: Date.now(),
                    rejectionReason: rejectionReason 
                });
                
                // ‡ß®. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ trust Score ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ì ‡¶®‡¶§‡ßÅ‡¶® trust Score ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ
                const userResult = await runTransaction(userRef, (currentData) => {
                    if (currentData) {
                        currentData.tasksRejected = (currentData.tasksRejected || 0) + 1;
                        currentData.completedTasks = currentData.completedTasks || {};
                        delete currentData.completedTasks[taskId]; 
                        
                        // trust Score ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                        const newtrustScore = (currentData.trustScore || 0) + REJECT_trust_CHANGE;
                        currentData.trustScore = Math.min(100, Math.max(0, newtrustScore));
                        
                        // ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶®‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡¶á ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                        const currentSuspensionUntil = currentData.suspension?.suspendUntil || 0;
                        let suspendMinutes = 0;
                        let reasonMessage = '';
                        
                        if (currentData.trustScore <= 40) { suspendMinutes = 24 * 60; reasonMessage = '‡¶ü‡ßç‡¶∞‡¶æ‡¶∏‡ßç‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡ß™‡ß¶ ‡¶¨‡¶æ ‡¶§‡¶æ‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá: ‡ßß ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶®‡•§'; } 
                        else if (currentData.trustScore <= 50) { suspendMinutes = 3 * 60; reasonMessage = '‡¶ü‡ßç‡¶∞‡¶æ‡¶∏‡ßç‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡ß´‡ß¶ ‡¶¨‡¶æ ‡¶§‡¶æ‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá: ‡ß© ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶®‡•§'; } 
                        else if (currentData.trustScore <= 60) { suspendMinutes = 60; reasonMessage = '‡¶ü‡ßç‡¶∞‡¶æ‡¶∏‡ßç‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡ß¨‡ß¶ ‡¶¨‡¶æ ‡¶§‡¶æ‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá: ‡ßß ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶®‡•§'; } 
                        else if (currentData.trustScore <= 70) { suspendMinutes = 30; reasonMessage = '‡¶ü‡ßç‡¶∞‡¶æ‡¶∏‡ßç‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡ß≠‡ß¶ ‡¶¨‡¶æ ‡¶§‡¶æ‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá: ‡ß©‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶®‡•§'; }
                        
                        if (suspendMinutes > 0) {
                            const suspendUntil = Date.now() + (suspendMinutes * 60 * 1000);
                            
                            // ‡¶Ø‡¶¶‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶®‡¶ü‡¶ø ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶®‡ßá‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶Ø‡¶º, ‡¶§‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá
                            if (suspendUntil > currentSuspensionUntil) {
                                currentData.suspension = {
                                    suspended: true,
                                    suspendUntil: suspendUntil,
                                    reason: reasonMessage,
                                    issuedBy: currentUserId,
                                    issuedAt: Date.now()
                                };
                            }
                        }
                    }
                    return currentData;
                });
                
                if (userResult.committed) {
                    const finalUserData = userResult.snapshot.val();
                    const finaltrustScore = finalUserData.trustScore;
                    let notificationMessage = `‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶®‡¶§‡ßÅ‡¶® trustScore: ${finaltrustScore}`;
                    
                    if (finalUserData.suspension && finalUserData.suspension.suspended) {
                        // ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡¶∂‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá
                        notificationMessage += ` **‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§**`;
                    }
                    
                    showNotification(notificationMessage, 'info');

                } else {
                     showNotification('‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶¨‡¶ø‡¶ß‡¶ø ‡¶¨‡¶æ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§', 'error');
                }
                
            } catch (error) {
                console.error("Error rejecting proof:", error);
                showNotification(`‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${error.message || '‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø'}‡•§ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶¨‡¶ø‡¶ß‡¶ø ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`, 'error');
            }
        };
        
        // Tab switching logic (Existing logic - no change)
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Deactivate all tabs and content
                tabs.forEach(t => {
                    t.classList.remove('bg-blue-600', 'text-white');
                    t.classList.add('bg-gray-200', 'text-gray-700');
                });
                tabContents.forEach(tc => tc.classList.add('hidden'));

                // Activate the clicked tab and its content
                const tabName = tab.dataset.tab;
                document.getElementById(tabName).classList.remove('hidden');
                tab.classList.remove('bg-gray-200', 'text-gray-700');
                tab.classList.add('bg-blue-600', 'text-white');
                
                // ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶ó‡ßá‡¶≤‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶® ‡¶®‡ßá‡¶á ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶è‡¶ü‡¶ø startDataListeners ‡¶è ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶è‡¶á‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§
                if (tabName === 'settings') {
                    loadControlSettings(); 
                }
            });
        });

        // üî• ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
        saveReferralSettingsBtn.addEventListener('click', handleSaveReferralSettings);
        saveProductPointsBtn.addEventListener('click', handleSaveProductPoints);

        // Expose global functions for button clicks
        window.openAdminModal = openAdminModal;
        window.handleApproveProof = handleApproveProof;
        window.handleRejectProof = handleRejectProof;
        window.handleApproveReport = handleApproveReport;
        window.handleRejectReport = handleRejectReport;
        window.handleUnsuspendUser = handleUnsuspendUser; 
    </script>
</body>
</html>

