<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</title>
    <script src="https://cdn.tailwindcss.com"> </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* ‡¶´‡¶®‡ßç‡¶ü ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶® */
        body {
            font-family: 'Hind Siliguri', Inter, sans-serif;
            background-color: #f7f9fc;
            min-height: 100vh;
        }

        /* ‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ - ‡¶Ü‡¶ß‡ßÅ‡¶®‡¶ø‡¶ï ‡¶®‡ßÄ‡¶≤ */
        .brand-blue {
            background-color: #0d6efd;
            transition: background-color 0.2s;
        }
        
        .brand-blue:hover {
            background-color: #0b5ed7;
        }

        .brand-blue-text {
            color: #0d6efd;
        }

        /* ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ - ‡¶è‡¶≤‡¶ø‡¶≠‡ßá‡¶ü‡ßá‡¶° ‡¶≤‡ßÅ‡¶ï */
        .app-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
            transition: box-shadow 0.3s, transform 0.2s;
        }

        .app-card:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            transform: translateY(-1px);
        }

        /* ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶ø‡¶Ç */
        .app-input {
            border: 1px solid #ced4da;
            border-radius: 8px;
            padding: 12px;
            font-size: 16px;
            background-color: white;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .app-input:focus {
            outline: none;
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }

        .hidden {
            display: none !important;
        }

        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            gap: 1rem;
            color: #333;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .spinner {
            border: 4px solid #e5e7eb;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal / Popup Styles */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            display: none; /* Initial state */
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.3s ease;
        }

        .popup-overlay.active {
            display: flex;
        }

        .popup-content {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            animation: zoomIn 0.3s ease-out;
        }

        @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .close-button {
            position: absolute;
            top: 0.75rem;
            right: 1rem;
            font-size: 2rem;
            cursor: pointer;
            color: #9ca3af;
        }

        /* Profile Card Styles */
        .profile-card {
            max-width: 600px;
            margin: 2rem auto;
            text-align: center;
            padding: 2.5rem;
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .profile-avatar {
            position: relative;
            display: inline-block;
        }
        
        .avatar-circle {
            width: 7rem;
            height: 7rem;
            border-radius: 9999px;
            background-color: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4b5563;
            font-size: 3.5rem;
            font-weight: bold;
            border: 2px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .profile-avatar img {
            width: 7rem;
            height: 7rem;
            border-radius: 9999px;
            object-fit: cover;
            border: 2px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* ----- ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶° ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ (‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§) ----- */
        .verified-badge {
            position: absolute;
            bottom: 0.5rem;
            right: 0.5rem;
            background-color: #1877F2; /* ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶¨‡ßç‡¶≤‡ßÅ */
            color: white; /* ‡¶∏‡¶æ‡¶¶‡¶æ ‡¶ö‡ßá‡¶ï-‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            /* ‡¶ö‡ßá‡¶ï-‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï ‡¶Ü‡¶á‡¶ï‡¶®‡ßá‡¶∞ ‡¶Ü‡¶ï‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú */
            font-size: 14px; 
            font-weight: bold;
            border: 2px solid white; /* ‡¶®‡ßÄ‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú‡¶ü‡¶ø‡¶ï‡ßá ‡¶ò‡¶ø‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶æ‡¶¶‡¶æ ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶ï */
        }
        
        /* ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ø‡ßá ‡¶´‡¶®‡ßç‡¶ü-‡¶Ö‡¶∏‡¶æ‡¶Æ ‡¶Ü‡¶á‡¶ï‡¶®‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶ø‡¶§ ‡¶π‡ßü */
        .verified-badge .fa-check { 
            line-height: 1;
        }
        /* ----- ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶° ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶∂‡ßá‡¶∑ ----- */


        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 1.5rem;
            text-align: center;
            margin-top: 1.5rem;
        }

        .stat-item {
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #1f2937;
        }

        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        .stat-item-points {
            background-color: #e5f5f9;
        }

        .stat-item-points .stat-value {
            color: #0d6efd;
        }
        
        .stat-item-success {
            background-color: #e6f9f0;
        }
        .stat-item-success .stat-value {
            color: #10b981;
        }

        .stat-item-fail {
            background-color: #fcebeb;
        }
        .stat-item-fail .stat-value {
            color: #ef4444;
        }
        
        /* --- ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ --- */
        .rating-container {
            /* ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶®‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ - ‡¶™‡ßÅ‡¶∞‡ßã ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶Ö‡¶Ç‡¶∂‡¶ü‡¶ø‡¶ï‡ßá ‡¶Æ‡¶æ‡¶ù‡¶ñ‡¶æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶§‡ßá */
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .rating-title {
            /* "‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ" ‡¶≤‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
            font-size: 1rem;
            font-weight: 600;
            color: #4b5563;
            margin-bottom: 0.5rem;
        }

        .rating-bar {
            /* ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶è‡¶ï‡¶§‡ßç‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø */
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.25rem;
        }

        .star {
            font-size: 1.25rem; /* ‡¶§‡¶æ‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ï‡¶æ‡¶∞ */
        }

        .filled-star {
            color: #ffc107; /* ‡¶∏‡ßã‡¶®‡¶æ‡¶≤‡ßÄ ‡¶∞‡¶Ç */
        }

        .empty-star {
            color: #e9ecef; /* ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶§‡¶æ‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶ß‡ßÇ‡¶∏‡¶∞ */
        }
        /* --- ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶∂‡ßá‡¶∑ --- */

    </style>
</head>

<body class="p-4 flex flex-col items-center justify-center">
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>

    <div class="container hidden" id="profile-container">
        
        <div class="app-card profile-card">
            
            <div class="profile-header">
                <div class="profile-avatar" id="profile-avatar-container">
                    </div>
                <div>
                    <h1 class="text-2xl font-bold text-gray-800" id="userName">‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ</h1>
                    <p class="text-sm text-gray-500 mt-1">
                        ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø: <span id="userIdDisplay" class="font-mono text-xs bg-gray-100 px-2 py-0.5 rounded">user123</span>
                    </p>
                    <p class="text-gray-500 text-sm mt-1" id="userEmailDisplay"></p>
                </div>
                
                <!-- ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ -->
                <div class="rating-container">
                    <!-- ‡¶®‡¶§‡ßÅ‡¶®: "‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ" ‡¶≤‡ßá‡¶ñ‡¶æ‡¶ü‡¶ø ‡¶â‡¶™‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá -->
                    <div class="rating-title">‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ</div>
                    
                    <div class="rating-bar" id="credibilityRatingBar">
                        <!-- JavaScript ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶ï‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá -->
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-item stat-item-points">
                    <div class="stat-value" id="userPoints">‡ß¶</div>
                    <div class="stat-label">‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü</div>
                </div>
                <div class="stat-item stat-item-success">
                    <div class="stat-value" id="successfulWorks">‡ß¶</div>
                    <div class="stat-label">‡¶∏‡¶´‡¶≤ ‡¶ï‡¶æ‡¶ú</div>
                </div>
                <div class="stat-item stat-item-fail">
                    <div class="stat-value" id="failedWorks">‡ß¶</div>
                    <div class="stat-label">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶æ‡¶ú</div>
                </div>
            </div>

            <div class="text-center mt-6">
                <button class="bg-gray-200 text-gray-800 font-bold py-2.5 px-6 rounded-full hover:bg-gray-300 transition-all duration-200" onclick="showEditProfilePopup()">
                    <i class="fas fa-edit mr-2"></i> ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                </button>
                <a href="index.html" class="inline-flex items-center brand-blue text-white font-bold py-2.5 px-6 rounded-full hover:bg-blue-700 transition-all duration-200 mt-4">
                    <i class="fas fa-arrow-left mr-2"></i>
                    ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
                </a>
            </div>

        </div>
    </div>
    
    <div id="editProfilePopup" class="popup-overlay">
        <div class="popup-content">
            <span class="close-button" onclick="closePopup()">&times;</span>
            <h2 class="text-xl font-bold text-gray-800 mb-6 text-center">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <form id="editProfileForm" class="space-y-4">
                
                <div class="form-group">
                    <label for="profilePhoto" class="block text-sm font-medium text-gray-700 mb-2">
                        ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶´‡¶ü‡ßã ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                    </label>
                    <input type="file" id="profilePhoto" name="profilePhoto" accept="image/*" class="app-input w-full">
                </div>
                
                <div class="form-group">
                    <label for="facebookName" class="block text-sm font-medium text-gray-700 mb-2">
                        ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶Ü‡¶á‡¶°‡¶ø‡¶∞ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ
                    </label>
                    <input type="text" id="facebookName" name="facebookName" class="app-input w-full" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: Shuvo Ahamed" required>
                </div>

                <div class="form-group">
                    <label for="userEmailInput" class="block text-sm font-medium text-gray-700 mb-2">
                        ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ
                    </label>
                    <input type="email" id="userEmailInput" name="userEmail" class="app-input w-full" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤" readonly>
                </div>
                
                <div id="facebookLinksContainer">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶Ü‡¶á‡¶°‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï (‡¶ó‡ßÅ‡¶≤‡ßã)
                    </label>
                    </div>
                
                <button type="button" class="w-full bg-gray-200 text-gray-700 font-bold py-2.5 px-4 rounded-lg hover:bg-gray-300 transition-all duration-200" id="addLinkButton">
                    <i class="fas fa-plus-circle mr-2"></i> ‡¶Ü‡¶∞‡ßã ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®
                </button>

                <button type="submit" class="w-full brand-blue text-white font-bold py-3 px-4 rounded-lg hover:shadow-lg transition duration-200">
                    ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
                </button>
            </form>
        </div>
    </div>
    
    <div id="notification-container"></div>
    

<script type="module">
    // NOTE: This setup assumes 'rtdb-config.js' contains the necessary Firebase Realtime Database and Auth setup exports.
    import { auth, rtdb, showNotification, set, ref, update, onValue, get } from "./rtdb-config.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
    
    const loadingOverlay = document.getElementById('loading-overlay');
    const profileContainer = document.getElementById('profile-container');
    
    let userId;

    // ----------------------------------------------------------------------
    // üî• Cloudinary ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® - ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
    // ----------------------------------------------------------------------
    const CLOUDINARY_CLOUD_NAME = 'deqeko2ny'; 
    const CLOUDINARY_UPLOAD_PRESET = 'Profilepicture'; 
    const CLOUDINARY_URL = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`;
    // ----------------------------------------------------------------------

    window.closePopup = () => {
        document.getElementById('editProfilePopup').style.display = 'none';
    };

    window.showEditProfilePopup = async () => {
        if (!userId) return;
        const userProfileRef = ref(rtdb, `users/${userId}`);
        const snapshot = await get(userProfileRef);
        const data = snapshot.val();
        
        if (data) {
            document.getElementById('facebookName').value = data.facebookName || '';
            document.getElementById('userEmailInput').value = auth.currentUser.email || '‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶®‡ßá‡¶á';
            
            const linksContainer = document.getElementById('facebookLinksContainer');
            linksContainer.innerHTML = `
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶Ü‡¶á‡¶°‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï (‡¶ó‡ßÅ‡¶≤‡ßã)
                </label>`;
            
            const currentLinks = Array.isArray(data.facebookLinks) 
                                ? data.facebookLinks 
                                : Object.values(data.facebookLinks || {});

            if (currentLinks.length > 0 && currentLinks[0] !== '#') {
                currentLinks.forEach(link => {
                    if (link && link.trim() !== '') {
                         addLinkInput(linksContainer, link);
                    }
                });
            } else {
                addLinkInput(linksContainer, '');
            }
        }
        document.getElementById('editProfilePopup').style.display = 'flex';
    };
    
    function addLinkInput(container, value = '') {
        const input = document.createElement('input');
        input.type = 'url';
        input.name = 'facebookLink';
        input.value = value;
        input.className = 'app-input w-full mb-2';
        input.placeholder = '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï';
        container.appendChild(input);
    }
    
    document.getElementById('addLinkButton').addEventListener('click', function() {
        const linksContainer = document.getElementById('facebookLinksContainer');
        addLinkInput(linksContainer, '');
    });

    // Cloudinary ‡¶§‡ßá ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶°‡ßá‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    async function uploadToCloudinary(file) {
        if (!file) return null;

        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
        // Cloudinary-‡¶§‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶æ‡¶¨-‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø 
        // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶∏‡ßá‡¶ü‡ßá 'engagehub' ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá, ‡¶§‡¶æ‡¶á ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶π‡¶¨‡ßá: engagehub/user_profiles/{userId}
        formData.append('folder', `user_profiles/${userId}`); 

        try {
            showNotification("‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...", 'info');
            const response = await fetch(CLOUDINARY_URL, {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                const errorData = await response.json();
                console.error("Cloudinary Error:", errorData);
                throw new Error(`Cloudinary ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${errorData.error.message || response.statusText}`);
            }

            const data = await response.json();
            showNotification("‡¶õ‡¶¨‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!", 'success');
            return data.secure_url; // ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶õ‡¶¨‡¶ø‡¶∞ URL
        } catch (error) {
            // ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡¶≤‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ß‡¶∞‡¶æ ‡¶™‡ßú‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá
            console.error("Error during Cloudinary upload:", error);
            showNotification(`‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`, 'error');
            throw error; 
        }
    }


    document.getElementById('editProfileForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        // ‡¶∏‡ßá‡¶≠ ‡¶¨‡ßã‡¶§‡¶æ‡¶Æ ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ø‡¶æ‡¶§‡ßá ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶®‡¶æ ‡¶π‡¶Ø‡¶º
        const saveButton = this.querySelector('button[type="submit"]');
        saveButton.disabled = true;
        saveButton.textContent = '‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';

        try {
            const newFacebookLinks = Array.from(document.querySelectorAll('#facebookLinksContainer input[name="facebookLink"]'))
                                    .map(input => input.value)
                                    .filter(link => link.trim() !== '');

            const profilePhotoFile = document.getElementById('profilePhoto').files[0];
            let profilePhotoUrl = '';

            if (profilePhotoFile) {
                // Cloudinary ‡¶§‡ßá ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                profilePhotoUrl = await uploadToCloudinary(profilePhotoFile);
            }
            
            const newData = {
                facebookName: document.getElementById('facebookName').value,
                // ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶Ç ‡¶¨‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßá ‡¶õ‡¶æ‡¶°‡¶º‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶°‡ßá‡¶ü‡¶æ RTDB-‡¶§‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶§‡¶æ Object ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡•§
                facebookLinks: newFacebookLinks.length > 0 ? newFacebookLinks : ['#']
            };

            if (profilePhotoUrl) {
                newData.profilePhotoUrl = profilePhotoUrl;
            }
            
            const userProfileRef = ref(rtdb, `users/${userId}`);
            
            await update(userProfileRef, newData); 
            showNotification("‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!", 'success');

            closePopup();

        } catch (error) {
            // Cloudinary ‡¶Ü‡¶™‡¶≤‡ßã‡¶°‡ßá ‡¶è‡¶∞‡¶∞ ‡¶π‡¶≤‡ßá catch ‡¶π‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá
            // ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ RTDB ‡¶Ü‡¶™‡¶≤‡ßã‡¶°‡ßá‡¶ì ‡¶è‡¶∞‡¶∞ ‡¶π‡¶≤‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá catch ‡¶π‡¶¨‡ßá
            console.error("Error during profile update:", error);
            // ‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶ï‡¶∞‡ßá ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶® ‡¶®‡ßá‡¶á ‡¶ï‡¶æ‡¶∞‡¶£ Cloudinary ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶®‡¶ø‡¶ú‡ßá‡¶á ‡¶è‡¶ü‡¶ø ‡¶ï‡¶∞‡ßá
            if (!error.message.includes('Cloudinary')) { 
                 showNotification("‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§", 'error');
            }
        } finally {
            // ‡¶∏‡ßá‡¶≠ ‡¶¨‡ßã‡¶§‡¶æ‡¶Æ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®
            saveButton.disabled = false;
            saveButton.textContent = '‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®';
        }
    });
    
    // ======================================================================
    // üî• ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶ó‡¶£‡¶®‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    // ======================================================================

    // ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®: ‡¶∏‡¶´‡¶≤ ‡¶ì ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø ‡¶ï‡¶∞‡ßá ‡ß´-‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶ó‡¶£‡¶®‡¶æ ‡¶ï‡¶∞‡ßá
    function calculateRating(completed, rejected) {
        const total = completed + rejected;
        if (total === 0) {
            // ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶æ‡¶ú ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶¨‡ßá ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡ß©.‡ß¶ ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø ‡¶¨‡¶æ ‡ß¶ ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø‡•§
            // ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶¨‡ßã‡¶ù‡¶æ‡¶§‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡ß©.‡ß¶ ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡¶≤‡ßã‡•§
            return 3.0; 
        }
        // ‡¶∏‡¶´‡¶≤ ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶π‡¶æ‡¶∞‡¶ï‡ßá ‡ß´ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ó‡ßÅ‡¶£ ‡¶ï‡¶∞‡ßá ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ
        const successRate = completed / total;
        // ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡ß¶ ‡¶•‡ßá‡¶ï‡ßá ‡ß´ ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá, ‡¶è‡¶ï ‡¶¶‡¶∂‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡¶¨‡ßá
        const rating = parseFloat((5 * successRate).toFixed(1));
        return rating;
    }

    // ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®: ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶ï‡¶® ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá
    function renderStarRating(score) {
        const ratingBar = document.getElementById('credibilityRatingBar');
        if (!ratingBar) return;

        ratingBar.innerHTML = ''; // ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®
        
        // ‡¶®‡¶ø‡¶ï‡¶ü‡¶§‡¶Æ ‡¶Ö‡¶∞‡ßç‡¶ß-‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ (0.5) ‡¶è ‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá
        const roundedScore = Math.round(score * 2) / 2; 

        let html = '';
        for (let i = 1; i <= 5; i++) {
            if (roundedScore >= i) {
                // ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞
                html += `<i class="fas fa-star star filled-star"></i>`;
            } else if (roundedScore === i - 0.5) {
                // ‡¶Ö‡¶∞‡ßç‡¶ß ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ (fa-star-half-alt ‡¶¨‡¶æ fa-star-half ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá)
                html += `<i class="fas fa-star-half-alt star filled-star"></i>`;
            } else {
                // ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞
                html += `<i class="far fa-star star empty-star"></i>`;
            }
        }
        
        // ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶∏‡¶π ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
        html += `<span class="text-lg font-bold ml-2 text-gray-800">(${score.toFixed(1)} / 5)</span>`;
        // "‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ" ‡¶≤‡ßá‡¶ñ‡¶æ‡¶ü‡¶ø HTML-‡¶è ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ div-‡¶è ‡¶∏‡¶∞‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá, ‡¶§‡¶æ‡¶á ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶∞ ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶®‡ßá‡¶á
        ratingBar.innerHTML = html;
    }
    
    // ======================================================================
    // üî• ‡¶Æ‡ßÇ‡¶≤ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    // ======================================================================
    
    // Function to update the profile display elements
    function updateProfileUI(data) {
        const profileAvatarContainer = document.getElementById('profile-avatar-container');
        profileAvatarContainer.innerHTML = '';
        
        // Avatar setup
        const avatarElement = document.createElement(data.profilePhotoUrl ? 'img' : 'div');
        if (data.profilePhotoUrl) {
             // Cloudinary URL ‡¶•‡¶æ‡¶ï‡¶≤‡ßá <img src="..."> ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
            avatarElement.src = data.profilePhotoUrl; 
            avatarElement.alt = data.facebookName;
            avatarElement.className = 'profile-avatar';
        } else {
             // Cloudinary URL ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü Avatar ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
            avatarElement.className = 'avatar-circle';
            avatarElement.textContent = (data.facebookName ? data.facebookName.charAt(0) : 'A').toUpperCase();
        }
        profileAvatarContainer.appendChild(avatarElement);

        // Verified Badge setup (Icon changed to look like Facebook)
        const verifiedBadge = document.createElement('span');
        verifiedBadge.className = 'verified-badge';
        
        // ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø: ‡¶®‡ßÄ‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶∏‡¶æ‡¶¶‡¶æ '‚úì' ‡¶ö‡¶ø‡¶π‡ßç‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§
        // ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø fa-check ‡¶Ü‡¶á‡¶ï‡¶®‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§
        verifiedBadge.innerHTML = '<i class="fa fa-check" aria-hidden="true"></i>'; 

        if (data.isVerified) {
            profileAvatarContainer.appendChild(verifiedBadge);
        }
        
        // ‡¶°‡ßá‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶´‡¶≤ ‡¶ì ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶®‡¶ø‡¶®
        const completedWorks = data.tasksCompleted || 0;
        const rejectedWorks = data.tasksRejected || 0;

        // Update Stats
        document.getElementById('userName').textContent = data.facebookName || '‡¶®‡¶æ‡¶Æ ‡¶®‡ßá‡¶á';
        document.getElementById('userPoints').textContent = (data.points || 0).toLocaleString('bn-BD');
        
        document.getElementById('successfulWorks').textContent = completedWorks.toLocaleString('bn-BD');
        document.getElementById('failedWorks').textContent = rejectedWorks.toLocaleString('bn-BD');
        
        // ‡¶®‡¶§‡ßÅ‡¶®: ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶ó‡¶£‡¶®‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
        const ratingScore = calculateRating(completedWorks, rejectedWorks);
        renderStarRating(ratingScore);
        
    }
    
    // Firebase Auth State Listener
    onAuthStateChanged(auth, async (user) => {
        if (!user) {
            window.location.href = 'login.html'; // ‡¶Ø‡¶¶‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶á‡¶® ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá, ‡¶§‡¶¨‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡ßá‡¶ú‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®
            return;
        }

        userId = user.uid;
        document.getElementById('userIdDisplay').textContent = userId;
        document.getElementById('userEmailDisplay').textContent = user.email || '‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶®‡ßá‡¶á';
        
        const userProfileRef = ref(rtdb, `users/${userId}`);
        
        // Realtime listener for user profile data
        onValue(userProfileRef, (snapshot) => {
            const data = snapshot.val();
            
            if (data) {
                updateProfileUI(data);
            } else {
                // Create default profile if it doesn't exist
                const defaultData = {
                    facebookName: user.email ? user.email.split('@')[0] : '‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ',
                    email: user.email || '‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶®‡ßá‡¶á',
                    facebookLinks: ['#'],
                    isVerified: false,
                    tasksCreated: 0,
                    tasksCompleted: 0,
                    tasksRejected: 0,
                    points: 0,
                    profilePhotoUrl: ''
                };
                set(userProfileRef, defaultData)
                    .then(() => console.log("Default profile created in RTDB."))
                    .catch((error) => console.error("Error creating default profile in RTDB:", error));
            }
            loadingOverlay.classList.add('hidden');
            profileContainer.classList.remove('hidden');
        });
    });
    
</script>

</body>
</html>

