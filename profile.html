<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</title>
    <script src="https://cdn.tailwindcss.com"> </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* ‡¶´‡¶®‡ßç‡¶ü ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶® */
        body {
            font-family: 'Hind Siliguri', Inter, sans-serif;
            background-color: #f7f9fc;
            min-height: 100vh;
        }

        /* ‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ - ‡¶Ü‡¶ß‡ßÅ‡¶®‡¶ø‡¶ï ‡¶®‡ßÄ‡¶≤ */
        .brand-blue {
            background-color: #0d6efd;
            transition: background-color 0.2s;
        }
        
        .brand-blue:hover {
            background-color: #0b5ed7;
        }

        .brand-blue-text {
            color: #0d6efd;
        }

        /* üî• ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ - ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶ì ‡¶Ü‡¶ï‡¶∞‡ßç‡¶∑‡¶£‡ßÄ‡¶Ø‡¶º ‡¶≤‡ßÅ‡¶ï üî• */
        .app-card {
            background: white;
            border-radius: 16px; /* ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø ‡¶¨‡ßú ‡¶¨‡¶∞‡ßç‡¶°‡¶æ‡¶∞ Radius */
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08); /* ‡¶õ‡¶æ‡¶Ø‡¶º‡¶æ ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø ‡¶ó‡¶æ‡¶¢‡¶º ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã */
            border: 1px solid #e9ecef;
            transition: box-shadow 0.3s, transform 0.2s;
        }

        .app-card:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12); /* ‡¶π‡ßã‡¶≠‡¶æ‡¶∞‡ßá ‡¶Ü‡¶∞‡¶ì ‡¶ó‡¶æ‡¶¢‡¶º ‡¶õ‡¶æ‡¶Ø‡¶º‡¶æ */
            transform: translateY(-2px); /* ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø ‡¶¨‡ßá‡¶∂‡¶ø ‡¶â‡¶™‡¶∞‡ßá ‡¶ì‡¶†‡¶æ */
        }

        /* ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶ø‡¶Ç */
        .app-input {
            border: 1px solid #ced4da;
            border-radius: 8px;
            padding: 12px;
            font-size: 16px;
            background-color: white;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .app-input:focus {
            outline: none;
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }

        .hidden {
            display: none !important;
        }

        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            gap: 1rem;
            color: #333;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .spinner {
            border: 4px solid #e5e7eb;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal / Popup Styles */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            display: none; /* Initial state */
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.3s ease;
        }

        .popup-overlay.active {
            display: flex;
        }

        .popup-content {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            animation: zoomIn 0.3s ease-out;
        }

        @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .close-button {
            position: absolute;
            top: 0.75rem;
            right: 1rem;
            font-size: 2rem;
            cursor: pointer;
            color: #9ca3af;
        }

        /* Profile Card Styles */
        .profile-card {
            max-width: 600px;
            margin: 2rem auto;
            text-align: center;
            padding: 2.5rem;
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .profile-avatar {
            position: relative;
            display: inline-block;
        }
        
        .avatar-circle {
            width: 7rem;
            height: 7rem;
            border-radius: 9999px;
            background-color: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4b5563;
            font-size: 3.5rem;
            font-weight: bold;
            border: 2px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .profile-avatar img {
            width: 7rem;
            height: 7rem;
            border-radius: 9999px;
            object-fit: cover;
            border: 2px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* ----- ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶° ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ (‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§) ----- */
        .verified-badge {
            position: absolute;
            bottom: 0.5rem;
            right: 0.5rem;
            background-color: #1877F2; /* ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶¨‡ßç‡¶≤‡ßÅ */
            color: white; /* ‡¶∏‡¶æ‡¶¶‡¶æ ‡¶ö‡ßá‡¶ï-‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            /* ‡¶ö‡ßá‡¶ï-‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï ‡¶Ü‡¶á‡¶ï‡¶®‡ßá‡¶∞ ‡¶Ü‡¶ï‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú */
            font-size: 14px; 
            font-weight: bold;
            border: 2px solid white; /* ‡¶®‡ßÄ‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú‡¶ü‡¶ø‡¶ï‡ßá ‡¶ò‡¶ø‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶æ‡¶¶‡¶æ ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶ï */
        }
        
        /* ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ø‡ßá ‡¶´‡¶®‡ßç‡¶ü-‡¶Ö‡¶∏‡¶æ‡¶Æ ‡¶Ü‡¶á‡¶ï‡¶®‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶ø‡¶§ ‡¶π‡ßü */
        .verified-badge .fa-check { 
            line-height: 1;
        }
        /* ----- ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶° ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶∂‡ßá‡¶∑ ----- */

        /* --- ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ (‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§) --- */
        /* stats-grid ‡¶è‡¶ñ‡¶® ‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡ßç‡¶≤‡ßá‡¶ï‡ßç‡¶∏ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ */
        .stats-grid {
            display: flex;
            flex-wrap: wrap; /* ‡¶õ‡ßã‡¶ü ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá ‡¶®‡¶ø‡¶ö‡ßá ‡¶®‡¶æ‡¶Æ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø */
            gap: 1rem; /* üî• ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
            text-align: center;
            margin-top: 0.5rem; /* üî• ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡¶ø‡¶® ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
        }

        .stat-item {
            padding: 0.15rem; /* üî• ‡¶™‡ßç‡¶Ø‡¶æ‡¶°‡¶ø‡¶Ç ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); /* ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶õ‡¶æ‡¶Ø‡¶º‡¶æ */
            border: 1px solid #f3f4f6; /* ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶¨‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã */
            /* ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶â‡¶á‡¶°‡¶•: ‡¶õ‡ßã‡¶ü ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá ‡¶™‡ßÅ‡¶∞‡ßã ‡¶â‡¶á‡¶°‡¶• */
            width: 100%; 
            transition: width 0.3s ease-in-out, box-shadow 0.3s, transform 0.2s;
        }
        
        .stat-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        /* ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ */
        .other-stats-grid {
             display: grid;
             grid-template-columns: repeat(2, minmax(0, 1fr));
             gap: 1rem; /* üî• ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
             width: 100%;
        }

        /* ‡¶Æ‡¶ø‡¶°‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá (md:) ‡¶≤‡ßá‡¶Ü‡¶â‡¶ü ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® */
        @media (min-width: 768px) {
            .stat-item {
                 /* Md ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá 1/3 ‡¶Ö‡¶Ç‡¶∂ ‡¶¶‡¶ñ‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá */
                 width: calc(33.333% - 0.75rem); /* üî• ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶Æ‡¶ø‡¶Ø‡¶º‡ßá ‡¶∏‡¶æ‡¶Æ‡¶û‡ßç‡¶ú‡¶∏‡ßç‡¶Ø ‡¶ï‡¶∞‡¶æ */
            }
            .other-stats-grid {
                 /* 2/3 ‡¶Ö‡¶Ç‡¶∂ + gaps*/
                 width: calc(66.666% - 0.75rem); /* üî• ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶Æ‡¶ø‡¶Ø‡¶º‡ßá ‡¶∏‡¶æ‡¶Æ‡¶û‡ßç‡¶ú‡¶∏‡ßç‡¶Ø ‡¶ï‡¶∞‡¶æ */
            }
            
            /* ‡¶Ø‡¶ñ‡¶® ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡¶ü‡¶ø ‡¶¨‡¶°‡¶º ‡¶π‡¶¨‡ßá */
            .point-card-large {
                /* Md ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá 2/3 ‡¶Ö‡¶Ç‡¶∂ ‡¶¶‡¶ñ‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá */
                width: calc(66.666% - 0.75rem); /* üî• ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶Æ‡¶ø‡¶Ø‡¶º‡ßá ‡¶∏‡¶æ‡¶Æ‡¶û‡ßç‡¶ú‡¶∏‡ßç‡¶Ø ‡¶ï‡¶∞‡¶æ */
                /* üî• UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: ‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶° ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞‡ßá‡¶∞ ‡¶õ‡¶æ‡¶Ø‡¶º‡¶æ ‡¶Ø‡ßã‡¶ó */
                box-shadow: 0 10px 20px rgba(13, 110, 253, 0.2); 
                transform: scale(1.01); 
            }
            
            .point-card-large:hover {
                transform: scale(1.02) translateY(-2px); /* ‡¶π‡ßã‡¶≠‡¶æ‡¶∞‡ßá ‡¶Ü‡¶∞‡¶ì ‡¶°‡ßç‡¶∞‡¶æ‡¶Æ‡¶æ‡¶ü‡¶ø‡¶ï ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü */
            }

            /* ‡¶Ø‡¶ñ‡¶® ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡ßÅ‡¶ü‡¶ø ‡¶®‡¶ø‡¶ö‡ßá ‡¶ö‡¶≤‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá */
            .other-stats-full {
                /* Md ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá 100% ‡¶Ö‡¶Ç‡¶∂ ‡¶¶‡¶ñ‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá */
                width: 100%;
                /* üî• ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°: JS ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡¶ø‡¶®‡¶ï‡ßá ‡¶ì‡¶≠‡¶æ‡¶∞‡¶∞‡¶æ‡¶á‡¶° ‡¶ï‡¶∞‡¶§‡ßá !important ‡¶∏‡¶π ‡¶ï‡¶Æ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡¶ø‡¶® */
                margin-top: 0.75rem !important; 
                grid-template-columns: repeat(2, minmax(0, 1fr)); /* 2 ‡¶ï‡¶≤‡¶æ‡¶Æ ‡¶ß‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡¶¨‡ßá */
            }
        }
        
        /* ‡¶õ‡ßã‡¶ü ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡ßá ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶ø‡¶Ç: ‡¶Ø‡¶ñ‡¶® ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶¨‡¶°‡¶º ‡¶π‡¶¨‡ßá */
        .point-card-large {
            width: 100%; 
        }

        /* --- ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶∂‡ßá‡¶∑ --- */

        .stat-value {
            font-size: 1.75rem; /* üî• ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
            font-weight: bold;
            color: #1f2937;
        }
        
        /* üî• ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú ‡¶Ü‡¶ï‡¶∞‡ßç‡¶∑‡¶£‡ßÄ‡¶Ø‡¶º ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã (‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá) */
        .stat-item-points .stat-value {
            color: #0c57c4; /* ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø ‡¶ó‡¶æ‡¶¢‡¶º ‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶° ‡¶¨‡ßç‡¶≤‡ßÅ */
            font-size: 2.25rem; /* üî• ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
        }

        .stat-label {
            font-size: 0.8rem; /* üî• ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        .stat-item-points {
            background-color: #e5f5f9;
        }

        
        .stat-item-success {
            background-color: #e6f9f0;
        }
        .stat-item-success .stat-value {
            color: #059267; /* ‡¶∏‡¶¨‡ßÅ‡¶ú ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø ‡¶ó‡¶æ‡¶¢‡¶º ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã */
        }

        .stat-item-fail {
            background-color: #fcebeb;
        }
        .stat-item-fail .stat-value {
            color: #c93737; /* ‡¶≤‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø ‡¶ó‡¶æ‡¶¢‡¶º ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã */
        }
        
        /* --- ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ --- */
        .rating-container {
            /* ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶®‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ - ‡¶™‡ßÅ‡¶∞‡ßã ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶Ö‡¶Ç‡¶∂‡¶ü‡¶ø‡¶ï‡ßá ‡¶Æ‡¶æ‡¶ù‡¶ñ‡¶æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶§‡ßá */
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .rating-title {
            /* "‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ" ‡¶≤‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
            font-size: 1rem;
            font-weight: 600;
            color: #4b5563;
            margin-bottom: 0.5rem;
        }

        .rating-bar {
            /* ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶è‡¶ï‡¶§‡ßç‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø */
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.25rem;
        }

        .star {
            font-size: 1.25rem; /* ‡¶§‡¶æ‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ï‡¶æ‡¶∞ */
        }

        .filled-star {
            color: #ffc107; /* ‡¶∏‡ßã‡¶®‡¶æ‡¶≤‡ßÄ ‡¶∞‡¶Ç */
        }

        .empty-star {
            color: #e9ecef; /* ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶§‡¶æ‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶ß‡ßÇ‡¶∏‡¶∞ */
        }
        /* --- ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶∂‡ßá‡¶∑ --- */

        /* --- ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ --- */
        .verification-criteria-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f3f4f6;
        }
        .verification-criteria-item:last-child {
            border-bottom: none;
        }
        .criteria-text {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
        }
        .criteria-status .fa-check-circle {
            color: #10b981; /* ‡¶∏‡¶¨‡ßÅ‡¶ú */
        }
        .criteria-status .fa-times-circle {
            color: #ef4444; /* ‡¶≤‡¶æ‡¶≤ */
        }
        /* --- ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶∂‡ßá‡¶∑ --- */

    </style>
</head>

<body class="p-4 flex flex-col items-center justify-center">
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>

    <div class="container hidden" id="profile-container">
        
        <div class="app-card profile-card">
            
            <div class="profile-header">
                <div class="profile-avatar" id="profile-avatar-container">
                    </div>
                <div>
                    <h1 class="text-2xl font-bold text-gray-800" id="userName">‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ</h1>
                    <p class="text-sm text-gray-500 mt-1">
                        ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø: <span id="userIdDisplay" class="font-mono text-xs bg-gray-100 px-2 py-0.5 rounded">user123</span>
                    </p>
                    <p class="text-gray-500 text-sm mt-1" id="userEmailDisplay"></p>
                </div>
                
                <!-- ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ -->
                <div class="rating-container">
                    <!-- ‡¶®‡¶§‡ßÅ‡¶®: "‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ" ‡¶≤‡ßá‡¶ñ‡¶æ‡¶ü‡¶ø ‡¶â‡¶™‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá -->
                    <div class="rating-title">‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ</div>
                    
                    <div class="rating-bar" id="trustRatingBar">
                        <!-- JavaScript ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶ï‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá -->
                    </div>
                </div>
            </div>

            <!-- üî• ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶∞‡ßç‡¶°: ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶ì ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂ üî• -->
            <div class="app-card p-8 mt-6 text-center">
                <h3 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-chart-line text-green-500 mr-2"></i> ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂
                </h3>

                <!-- ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ó‡ßç‡¶∞‡¶ø‡¶° (‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§) -->
                <div class="stats-grid">
                    
                    <!-- ‡ßß. ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ -->
                    <div id="pointCardContainer" class="stat-item stat-item-points">
                        <div class="stat-value" id="userPoints">‡ß¶</div>
                        <div class="stat-label">‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü</div>
                    </div>

                    <!-- ‡ß®. ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ (‡¶∏‡¶´‡¶≤ ‡¶ï‡¶æ‡¶ú, ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶æ‡¶ú) -->
                    <!-- ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá 2/3 ‡¶Ö‡¶Ç‡¶∂ ‡¶®‡ßá‡¶¨‡ßá (md: ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶•‡ßá‡¶ï‡ßá) -->
                    <div id="otherStatsContainer" class="other-stats-grid">
                        <div class="stat-item stat-item-success">
                            <div class="stat-value" id="successfulWorks">‡ß¶</div>
                            <div class="stat-label">‡¶∏‡¶´‡¶≤ ‡¶ï‡¶æ‡¶ú</div>
                        </div>
                        <div class="stat-item stat-item-fail">
                            <div class="stat-value" id="failedWorks">‡ß¶</div>
                            <div class="stat-label">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶æ‡¶ú</div>
                        </div>
                    </div>
                </div>
                <!-- ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶∂‡ßá‡¶∑ -->
            </div>
            <!-- üî• ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶∂‡ßá‡¶∑ üî• -->


            <!-- üî• ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° ‡¶∏‡ßá‡¶ï‡¶∂‡¶®: ‡¶¨‡ßç‡¶≤‡ßÅ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ üî• -->
            <div class="app-card p-4 mt-6 text-left border-2 border-blue-500 bg-blue-50/50" id="blueVerifySection">
                <h3 class="text-xl font-bold text-gray-800 mb-3">
                    <i class="fas fa-certificate text-blue-500 mr-2"></i> ‡¶¨‡ßç‡¶≤‡ßÅ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏
                </h3>

                <!-- ‡¶™‡ßç‡¶∞‡ßã‡¶ó‡ßç‡¶∞‡ßá‡¶∏ ‡¶¨‡¶æ‡¶∞ -->
                <div class="mb-4">
                    <div class="flex justify-between text-sm font-semibold text-gray-600 mb-1">
                        <span id="verification-progress-text">‡ß¶/‡ßÆ‡¶ü‡¶ø ‡¶∂‡¶∞‡ßç‡¶§ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶π‡ßü‡ßá‡¶õ‡ßá</span>
                        <span id="verification-percentage">‡ß¶%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <!-- ‡¶∞‡¶Ç ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá blue-500 ‡¶è -->
                        <div id="verification-progress-bar" class="bg-blue-500 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">
                        ‡¶¨‡ßç‡¶≤‡ßÅ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶á ‡ßÆ‡¶ü‡¶ø ‡¶ï‡¶†‡ßã‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶° ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶∞‡¶æ ‡¶â‡¶ö‡ßç‡¶ö ‡¶Æ‡¶æ‡¶®‡ßá‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶™‡¶æ‡¶®‡•§
                    </p>
                </div>

                <!-- ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶ü‡ßá‡¶∞‡¶ø‡ßü‡¶æ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ -->
                <div id="verification-criteria-list" class="divide-y divide-gray-200">
                    <!-- JavaScript ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡ß≠‡¶ü‡¶ø ‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶ü‡ßá‡¶∞‡¶ø‡ßü‡¶æ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá -->
                </div>
                
                <!-- üî• ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶æ‡¶ü‡¶®: ‡¶§‡¶æ‡ßé‡¶ï‡ßç‡¶∑‡¶£‡¶ø‡¶ï ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø üî• -->
                <div class="mt-4 text-center">
                    <button 
                        id="applyForBlueVerify" 
                        class="w-full brand-blue text-white font-bold py-3 px-4 rounded-lg transition duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:shadow-none"
                        disabled
                    >
                        <!-- ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶á‡¶ï‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -->
                        <i class="fas fa-magic mr-2"></i> ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
                    </button>
                </div>
            </div>
            <!-- üî• ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶∂‡ßá‡¶∑ üî• -->

            <!-- üî• ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡ßá‡¶ï‡¶∂‡¶®: ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡ßá ‡¶¶‡ßÅ‡¶ü‡¶ø ‡¶Ö‡¶Ç‡¶∂ üî• -->
            <div class="app-card p-4 mt-6 text-center shadow-lg bg-indigo-50/50">
                <h3 class="text-xl font-bold text-gray-700 mb-4">
                    <i class="fas fa-share-alt mr-2 text-indigo-600"></i> ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶π‡¶æ‡¶¨
                </h3>

                <!-- ‡ßß. ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá -->
                <div class="border-b border-indigo-200 pb-4 mb-4">
                    <h4 class="text-lg font-semibold text-gray-800 mb-2">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶°</h4>
                    <div class="flex items-center justify-center gap-3 bg-white p-3 rounded-lg border border-indigo-300 shadow-inner">
                        <span id="referralCodeDisplay" class="font-mono text-xl font-bold text-indigo-700 tracking-widser">LOADING...</span>
                        <button id="copyReferralButton" class="brand-blue text-white p-2 rounded-lg transition duration-150 hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-300" title="‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶Ü‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ú‡¶æ‡¶®‡¶æ‡¶§‡ßá ‡¶è‡¶á ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                </div>

                <!-- ‡ß®. ‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶®: ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ø‡¶¶‡¶ø referrerCode ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶¨‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá -->
                <div id="referrerInputCard"> 
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶ø ‡¶ï‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                    <p class="text-sm text-gray-600 mb-4">‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶∞ ‡ß™-‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶â‡¶≠‡ßü‡¶á ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶®‡•§ (‡¶¨‡ßã‡¶®‡¶æ‡¶∏: <span id="referee-bonus-display">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</span>)</p>
                    
                    <div class="flex flex-col md:flex-row gap-3">
                        <input type="text" id="referrerCodeInput" class="app-input flex-grow text-center text-lg uppercase tracking-widest" placeholder="1234" maxlength="4">
                        <button id="applyReferralButton" class="brand-blue text-white font-bold py-3 px-6 rounded-lg transition duration-150 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-gift mr-2"></i> ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>
                    </div>
                </div>
                <!-- ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶∂‡ßá‡¶∑ -->
            </div>
            <!-- üî• ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶∂‡ßá‡¶∑ üî• -->


            <div class="text-center mt-6">
                <button class="bg-gray-200 text-gray-800 font-bold py-2.5 px-6 rounded-full hover:bg-gray-300 transition-all duration-200" onclick="showEditProfilePopup()">
                    <i class="fas fa-edit mr-2"></i> ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                </button>
                <a href="index.html" class="inline-flex items-center brand-blue text-white font-bold py-2.5 px-6 rounded-full hover:bg-blue-700 transition-all duration-200 mt-4">
                    <i class="fas fa-arrow-left mr-2"></i>
                    ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
                </a>
            </div>

        </div>
    </div>
    
    <div id="editProfilePopup" class="popup-overlay">
        <div class="popup-content">
            <span class="close-button" onclick="closePopup()">&times;</span>
            <h2 class="text-xl font-bold text-gray-800 mb-6 text-center">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <form id="editProfileForm" class="space-y-4">
                
                <div class="form-group">
                    <label for="profilePhoto" class="block text-sm font-medium text-gray-700 mb-2">
                        ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶´‡¶ü‡ßã ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                    </label>
                    <input type="file" id="profilePhoto" name="profilePhoto" accept="image/*" class="app-input w-full">
                </div>
                
                <div class="form-group">
                    <label for="facebookName" class="block text-sm font-medium text-gray-700 mb-2">
                        ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶Ü‡¶á‡¶°‡¶ø‡¶∞ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ
                    </label>
                    <input type="text" id="facebookName" name="facebookName" class="app-input w-full" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: Shuvo Ahamed" required>
                </div>

                <div class="form-group">
                    <label for="userEmailInput" class="block text-sm font-medium text-gray-700 mb-2">
                        ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ
                    </label>
                    <input type="email" id="userEmailInput" name="userEmail" class="app-input w-full" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤" readonly>
                </div>
                
                <div id="facebookLinksContainer">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶Ü‡¶á‡¶°‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï (‡¶ó‡ßÅ‡¶≤‡ßã)
                    </label>
                    </div>
                
                <button type="button" class="w-full bg-gray-200 text-gray-700 font-bold py-2.5 px-4 rounded-lg hover:bg-gray-300 transition-all duration-200" id="addLinkButton">
                    <i class="fas fa-plus-circle mr-2"></i> ‡¶Ü‡¶∞‡ßã ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®
                </button>

                <button type="submit" class="w-full brand-blue text-white font-bold py-3 px-4 rounded-lg hover:shadow-lg transition duration-200">
                    ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
                </button>
            </form>
        </div>
    </div>
    
    <div id="notification-container"></div>
    

<script type="module">
    // NOTE: This setup assumes 'rtdb-config.js' contains the necessary Firebase Realtime Database and Auth setup exports.
    import { auth, rtdb, showNotification, set, ref, update, onValue, get, runTransaction, push } from "./rtdb-config.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
    import { getDatabase, query, orderByChild, equalTo, limitToFirst, get as rtdbGet } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js";

    const loadingOverlay = document.getElementById('loading-overlay');
    const profileContainer = document.getElementById('profile-container');
    const applyButton = document.getElementById('applyForBlueVerify');
    
    // üî• ‡¶®‡¶§‡ßÅ‡¶®: ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡¶ø‡¶Ø‡¶º‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤
    let REFERRED_BONUS = 50; 
    let REFEREE_BONUS = 50;  
    let REFERRAL_CONTROLS_LOADED = false;
    const refereeBonusDisplay = document.getElementById('referee-bonus-display');

    let userId;
    let currentProfileData = {}; // ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø

    // ----------------------------------------------------------------------
    // üî• Cloudinary ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® - ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
    // ----------------------------------------------------------------------
    const CLOUDINARY_CLOUD_NAME = 'deqeko2ny'; // profile.html ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡ßá‡¶ì‡ßü‡¶æ
    const CLOUDINARY_UPLOAD_PRESET = 'Profilepicture'; // profile.html ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡ßá‡¶ì‡ßü‡¶æ
    const CLOUDINARY_URL = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`;
    // ----------------------------------------------------------------------

    /**
     * Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
     */
    const loadReferralControls = () => {
        const controlsRef = ref(rtdb, 'controls/referralBonus');
        // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø onlyOnce: true ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã ‡¶®‡¶æ, 
        // ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶è‡¶ü‡¶ø ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶≠‡¶¨‡¶ø‡¶∑‡ßç‡¶Ø‡¶§‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§
        onValue(controlsRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                REFERRED_BONUS = data.referredUser || 50; 
                REFEREE_BONUS = data.refereeUser || 50;
            }
            REFERRAL_CONTROLS_LOADED = true;
            refereeBonusDisplay.textContent = `${REFERRED_BONUS.toLocaleString('bn-BD')} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü`;
        });
    };
    
    // üî• ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶≤‡ßã‡¶°
    document.addEventListener('DOMContentLoaded', loadReferralControls);

    window.closePopup = () => {
        document.getElementById('editProfilePopup').style.display = 'none';
    };

    window.showEditProfilePopup = async () => {
        if (!userId) return;
        const userProfileRef = ref(rtdb, `users/${userId}`);
        const snapshot = await get(userProfileRef);
        const data = snapshot.val();
        
        if (data) {
            document.getElementById('facebookName').value = data.facebookName || '';
            document.getElementById('userEmailInput').value = auth.currentUser.email || '‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶®‡ßá‡¶á';
            
            const linksContainer = document.getElementById('facebookLinksContainer');
            linksContainer.innerHTML = `
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶Ü‡¶á‡¶°‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï (‡¶ó‡ßÅ‡¶≤‡ßã)
                </label>`;
            
            const currentLinks = Array.from(data.facebookLinks || []).filter(link => link && link.trim() !== '');

            if (currentLinks.length > 0 && currentLinks[0] !== '#') {
                currentLinks.forEach(link => {
                    if (link && link.trim() !== '') {
                         addLinkInput(linksContainer, link);
                    }
                });
            } else {
                addLinkInput(linksContainer, '');
            }
        }
        document.getElementById('editProfilePopup').style.display = 'flex';
    };
    
    function addLinkInput(container, value = '') {
        const input = document.createElement('input');
        input.type = 'url';
        input.name = 'facebookLink';
        input.value = value;
        input.className = 'app-input w-full mb-2';
        input.placeholder = '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï';
        container.appendChild(input);
    }
    
    document.getElementById('addLinkButton').addEventListener('click', function() {
        const linksContainer = document.getElementById('facebookLinksContainer');
        addLinkInput(linksContainer, '');
    });

    // Cloudinary ‡¶§‡ßá ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶°‡ßá‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    async function uploadToCloudinary(file) {
        if (!file) return null;

        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
        // Cloudinary-‡¶§‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶æ‡¶¨-‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø 
        // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶∏‡ßá‡¶ü‡ßá 'engagehub' ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá, ‡¶§‡¶æ‡¶á ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶π‡¶¨‡ßá: engagehub/user_profiles/{userId}
        formData.append('folder', `user_profiles/${userId}`); 

        const uploadController = new AbortController(); // Time out controler
        const signal = uploadController.signal;
        const TIMEOUT_MS = 120000; // 2 ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü (120000 ms)

        const timeoutId = setTimeout(() => {
            uploadController.abort();
            showNotification("‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶Ö‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶Æ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá (‡ß® ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü)‡•§", 'error');
        }, TIMEOUT_MS);

        try {
            showNotification("‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡¶è‡¶ü‡¶ø ‡ß® ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶∏‡¶Æ‡ßü ‡¶®‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§", 'info');
            const response = await fetch(CLOUDINARY_URL, {
                method: 'POST',
                body: formData,
                signal: signal // ‡¶ü‡¶æ‡¶á‡¶Æ‡¶Ü‡¶â‡¶ü ‡¶∏‡¶ø‡¶ó‡¶®‡¶æ‡¶≤ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
            });
            
            clearTimeout(timeoutId); // ‡¶∏‡¶´‡¶≤ ‡¶π‡¶≤‡ßá ‡¶ü‡¶æ‡¶á‡¶Æ‡¶Ü‡¶â‡¶ü ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶≤‡ßã

            if (!response.ok) {
                const errorData = await response.json();
                console.error("Cloudinary Error:", errorData);
                throw new Error(`Cloudinary ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${errorData.error.message || response.statusText}`);
            }

            const data = await response.json();
            // üî• ‡¶õ‡¶¨‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá‡¶á ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            showNotification("‡¶õ‡¶¨‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!", 'success'); 
            return data.secure_url; // ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶õ‡¶¨‡¶ø‡¶∞ URL
        } catch (error) {
            clearTimeout(timeoutId); // ‡¶è‡¶∞‡¶∞ ‡¶π‡¶≤‡ßá ‡¶ü‡¶æ‡¶á‡¶Æ‡¶Ü‡¶â‡¶ü ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
            
            if (error.name === 'AbortError') {
                // ‡¶è‡¶ü‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶∏‡ßá‡¶á ‡¶è‡¶∞‡¶∞ ‡¶Ø‡¶ñ‡¶® fetch ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶ü‡¶æ‡¶á‡¶Æ‡¶Ü‡¶â‡¶ü ‡¶π‡¶Ø‡¶º
                console.error("Cloudinary upload aborted due to timeout.");
                // ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® already shown in setTimeout
            } else {
                // ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶¨‡¶æ Cloudinary ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶è‡¶∞‡¶∞
                console.error("Error during Cloudinary upload:", error);
                showNotification(`‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${error.message}`, 'error');
            }
            throw error; 
        }
    }


    document.getElementById('editProfileForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        // ‡¶∏‡ßá‡¶≠ ‡¶¨‡ßã‡¶§‡¶æ‡¶Æ ‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ø‡¶æ‡¶§‡ßá ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶®‡¶æ ‡¶π‡¶Ø‡¶º
        const saveButton = this.querySelector('button[type="submit"]');
        saveButton.disabled = true;
        saveButton.textContent = '‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';

        try {
            const newFacebookLinks = Array.from(document.querySelectorAll('#facebookLinksContainer input[name="facebookLink"]'))
                                    .map(input => input.value)
                                    .filter(link => link.trim() !== '');

            const profilePhotoFile = document.getElementById('profilePhoto').files[0];
            let profilePhotoUrl = '';

            if (profilePhotoFile) {
                // Cloudinary ‡¶§‡ßá ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                // ‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º (‡¶ü‡¶æ‡¶á‡¶Æ‡¶Ü‡¶â‡¶ü ‡¶∏‡¶π), ‡¶§‡¶æ‡¶π‡¶≤‡ßá profilePhotoUrl ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶•‡¶æ‡¶ï‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç error catch ‡¶π‡¶¨‡ßá
                profilePhotoUrl = await uploadToCloudinary(profilePhotoFile); 
            }
            
            // ‡¶Ø‡¶¶‡¶ø Cloudinary ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶∏‡¶´‡¶≤ ‡¶®‡¶æ ‡¶π‡¶Ø‡¶º (‡¶Ø‡ßá‡¶Æ‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ‡¶Ü‡¶â‡¶ü), ‡¶§‡¶æ‡¶π‡¶≤‡ßá profilePhotoUrl ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶•‡¶æ‡¶ï‡¶¨‡ßá
            // ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ RTDB ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶è ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ text fields ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶¨‡ßá‡•§
            // ‡¶Ø‡¶¶‡¶ø Cloudinary ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® AbortError ‡¶¨‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã error throw ‡¶ï‡¶∞‡ßá, ‡¶§‡¶æ‡¶π‡¶≤‡ßá catch ‡¶¨‡ßç‡¶≤‡¶ï execute ‡¶π‡¶¨‡ßá‡•§

            const newData = {
                facebookName: document.getElementById('facebookName').value,
                // ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶Ç ‡¶¨‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßá ‡¶õ‡¶æ‡¶°‡¶º‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶°‡ßá‡¶ü‡¶æ RTDB-‡¶§‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶§‡¶æ Object ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡•§
                facebookLinks: newFacebookLinks.length > 0 ? newFacebookLinks : ['#']
            };

            // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá‡¶á URL ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá
            if (profilePhotoUrl) {
                newData.profilePhotoUrl = profilePhotoUrl;
            }
            
            const userProfileRef = ref(rtdb, `users/${userId}`);
            
            // Note: isVerified is updated in the onValue listener if criteria are met
            await update(userProfileRef, newData); 
            showNotification("‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!", 'success');

            closePopup();
            // ‡¶´‡¶æ‡¶á‡¶≤ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã ‡¶Ø‡¶æ‡¶§‡ßá ‡¶è‡¶ï‡¶á ‡¶õ‡¶¨‡¶ø ‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶Ø‡ßã‡¶ó ‡¶•‡¶æ‡¶ï‡ßá
            document.getElementById('profilePhoto').value = ''; 

        } catch (error) {
            // ‡¶Ø‡¶¶‡¶ø Cloudinary ‡¶Ü‡¶™‡¶≤‡ßã‡¶° AbortError ‡¶¶‡ßá‡ßü, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶Ü‡¶ó‡ßá‡¶á ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§
            if (error.name !== 'AbortError') { 
                 showNotification("‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§", 'error');
            }
            console.error("Error during profile update:", error);
        } finally {
            // ‡¶∏‡ßá‡¶≠ ‡¶¨‡ßã‡¶§‡¶æ‡¶Æ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®
            saveButton.disabled = false;
            saveButton.textContent = '‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®';
        }
    });
    
    // ======================================================================
    // üî• ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§: ‡¶§‡¶æ‡ßé‡¶ï‡ßç‡¶∑‡¶£‡¶ø‡¶ï ‡¶¨‡ßç‡¶≤‡ßÅ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    // ======================================================================
    async function instantBlueVerification() {
        if (!userId) {
            showNotification("‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", 'error');
            return;
        }
        
        // ‡¶∏‡¶¨ ‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶ü‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶§‡¶æ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®
        const criteria = checkVerificationCriteria(currentProfileData, auth.currentUser);
        const isFullyVerified = criteria.every(c => c.completed);

        if (!isFullyVerified) {
            showNotification("‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶∂‡¶∞‡ßç‡¶§ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§", 'error');
            return;
        }

        applyButton.disabled = true;
        applyButton.textContent = '‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...'; // New text
        applyButton.classList.remove('brand-blue');
        applyButton.classList.add('bg-orange-500'); // Temporary color

        try {
            
            // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡¶æ‡ßé‡¶ï‡ßç‡¶∑‡¶£‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
            await update(ref(rtdb, `users/${userId}`), {
                isVerified: true, // ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
                blueVerifyStatus: 'Approved', // ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø 'Approved'
                verificationDate: Date.now() // ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶Ø‡ßã‡¶ó
            });

            showNotification("‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶§‡¶æ‡ßé‡¶ï‡ßç‡¶∑‡¶£‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶¨‡ßç‡¶≤‡ßÅ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶° ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®!", 'success');
            applyButton.textContent = '‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶°!';
            applyButton.classList.remove('bg-orange-500');
            applyButton.classList.add('bg-green-600');
            
        } catch (error) {
            console.error("Error performing instant verification:", error);
            showNotification(`‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${error.message}`, 'error');
            applyButton.textContent = '‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®';
            applyButton.classList.remove('bg-orange-500');
            applyButton.classList.add('brand-blue');
            applyButton.disabled = false;
        }
    }
    
    // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
    document.addEventListener('DOMContentLoaded', () => {
        // üî• ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã: applyForBlueVerification ‡¶•‡ßá‡¶ï‡ßá instantBlueVerification
        applyButton.addEventListener('click', instantBlueVerification); 
        
        document.getElementById('copyReferralButton').addEventListener('click', () => {
            const code = document.getElementById('referralCodeDisplay').textContent;
            if (code && code !== 'LOADING...' && code !== 'XXXX') {
                copyReferralCode(code);
            } else {
                 showNotification("‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶è‡¶ñ‡¶®‡ßã ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø ‡¶¨‡¶æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§", 'info');
            }
        });
        document.getElementById('applyReferralButton').addEventListener('click', applyReferralCode);
    });

    /**
     * ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
     * @param {string} code - ‡¶Ø‡ßá ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§
     */
    async function copyReferralCode(code) {
        // navigator.clipboard.writeText() ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶Ø‡¶æ ‡¶¨‡ßá‡¶∂‡¶ø‡¶∞‡¶≠‡¶æ‡¶ó ‡¶Ü‡¶ß‡ßÅ‡¶®‡¶ø‡¶ï ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá‡•§
        try {
            await navigator.clipboard.writeText(code);
            showNotification("‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!", 'success');
        } catch (err) {
            console.error('‡¶ï‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶ï‡¶™‡¶ø ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:', err);
            // ‡¶´‡¶≤‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá 
            const input = document.createElement('textarea');
            input.value = code;
            document.body.appendChild(input);
            input.select();
            document.execCommand('copy');
            document.body.removeChild(input);
            showNotification("‡¶ï‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•, ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤‡¶ø ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", 'error');
        }
    }


    /**
     * üî• ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®: ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡ßá ‡¶è‡¶¨‡¶Ç ‡¶â‡¶≠‡ßü‡¶ï‡ßá ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡ßá‡ßü‡•§
     * ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶ø‡¶ï‡ßá ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø runTransaction ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‡¶Ø‡¶æ‡¶§‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡¶∑‡ßç‡¶ü ‡¶®‡¶æ ‡¶π‡¶Ø‡¶º‡•§
     */
    async function applyReferralCode() {
        
        if (!REFERRAL_CONTROLS_LOADED) {
            showNotification("‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", 'info');
            return;
        }
        
        const inputElement = document.getElementById('referrerCodeInput'); 
        const applyButton = document.getElementById('applyReferralButton');
        const referrerCode = inputElement.value.toUpperCase().trim();
        
        // üî• ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: REFEREE_BONUS ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
        const refereeBonus = REFEREE_BONUS; 
        const referredBonus = REFERRED_BONUS; // ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶è‡¶á ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶¨‡ßá
        
        applyButton.disabled = true;
        inputElement.disabled = true;
        applyButton.textContent = '‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';

        if (referrerCode.length !== 4) {
            showNotification('‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡ß™ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§', 'error');
            applyButton.disabled = false;
            inputElement.disabled = false;
            applyButton.textContent = '‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®';
            return;
        }

        // 1. ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶ï‡ßã‡¶° ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ
        const userProfileRef = ref(rtdb, `users/${userId}`);
        const userSnapshot = await rtdbGet(userProfileRef);
        const userData = userSnapshot.val();
        
        if (userData && userData.referralCode === referrerCode) {
            showNotification('‡¶Ü‡¶™‡¶®‡¶ø ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§', 'error');
            applyButton.disabled = false;
            inputElement.disabled = false;
            applyButton.textContent = '‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®';
            return;
        }
        
        // 2. ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶ï‡¶ø‡¶®‡¶æ ‡¶§‡¶æ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®
        const usersRef = ref(rtdb, 'users');
        const codeQuery = query(usersRef, orderByChild('referralCode'), equalTo(referrerCode), limitToFirst(1));
        
        try {
            const snapshot = await rtdbGet(codeQuery);
            
            if (!snapshot.exists() || snapshot.val() === null) {
                showNotification('‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§', 'error');
                applyButton.disabled = false;
                inputElement.disabled = false;
                applyButton.textContent = '‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®';
                return;
            }
            
            // 3. ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶ø‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
            const refereeData = snapshot.val();
            const refereeUserId = Object.keys(refereeData)[0];
            const refereeName = refereeData[refereeUserId].facebookName || '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ';
            
            // 4. üî• ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®: ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶ø‡¶ï‡ßá ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡¶ø‡¶® (‡¶°‡ßá‡¶ü‡¶æ ‡¶Ö‡¶ñ‡¶£‡ßç‡¶°‡¶§‡¶æ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§)
            const refereeRef = ref(rtdb, `users/${refereeUserId}`);
            const refereeTransactionResult = await runTransaction(refereeRef, (currentData) => {
                if (currentData) {
                    currentData.points = (currentData.points || 0) + refereeBonus; // <<< REFEREE_BONUS ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
                    currentData.referralSuccesses = (currentData.referralSuccesses || 0) + 1;
                }
                return currentData;
            });

            if (!refereeTransactionResult || !refereeTransactionResult.committed) {
                throw new Error("Referee point update transaction failed.");
            }

            // 5. üî• ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶ì referrerCode ‡¶¶‡¶ø‡¶®
            const currentUserCurrentPoints = userData.points || 0;
            const updates = {
                points: currentUserCurrentPoints + referredBonus, // <<< REFERRED_BONUS ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
                referrerCode: referrerCode, // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
            };
            
            // runTransaction ‡¶∏‡¶´‡¶≤ ‡¶π‡¶≤‡ßá, ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
            await update(userProfileRef, updates);

            showNotification(`‡¶∏‡¶´‡¶≤! ‡¶Ü‡¶™‡¶®‡¶ø (${referredBonus} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü) ‡¶è‡¶¨‡¶Ç ${refereeName} (${refereeBonus} ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü) ‡¶â‡¶≠‡ßü‡ßá‡¶á ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®!`, 'success');
            
            // ‡¶∏‡¶´‡¶≤ ‡¶π‡¶≤‡ßá ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡¶ü‡¶ø ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶® (‡¶è‡¶ñ‡¶® ‡¶è‡¶ü‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶≠‡¶ø‡¶§‡¶∞‡ßá‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø DIV)
            document.getElementById('referrerInputCard').classList.add('hidden');


        } catch (error) {
            console.error("Error applying referral code:", error);
            showNotification(`‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡ßã‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ${error.message}`, 'error');
        } finally {
            applyButton.disabled = false;
            inputElement.disabled = false;
            applyButton.textContent = '‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®';
        }
    }

    // ======================================================================
    // üî• ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶ó‡¶£‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    // ======================================================================
    /**
     * trustScore-‡¶ï‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡ßç‡¶ï‡ßá‡¶≤ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡ß´-‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ï‡ßá‡¶≤‡ßá ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞ ‡¶ï‡¶∞‡ßá‡•§
     * 20 = 1 Star, 40 = 2 Stars, 60 = 3 Stars, 80 = 4 Stars, 100 = 5 Stars
     * @param {number} rawScore - ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú‡ßá‡¶∞ raw trustScore (0 ‡¶•‡ßá‡¶ï‡ßá 100 ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§)‡•§
     * @returns {number} - ‡ß´-‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç (‡ß¶.‡ß¶ ‡¶•‡ßá‡¶ï‡ßá ‡ß´.‡ß¶)‡•§
     */
    function mapScoreToFiveStarRating(rawScore) {
        const score = rawScore || 0;
        const maxScore = 100;
        const minRating = 1.0;
        const maxRating = 5.0;
        const minScoreForRating = 20; // 20 ‡¶¨‡¶æ ‡¶è‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá 1 ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞

        if (score <= minScoreForRating) return minRating;
        if (score >= maxScore) return maxRating;

        // 20 ‡¶•‡ßá‡¶ï‡ßá 100 ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶∏‡ßç‡¶ï‡ßã‡¶∞‡¶ï‡ßá 1.0 ‡¶•‡ßá‡¶ï‡ßá 5.0 ‡¶è ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡¶æ
        const normalizedScore = (score - minScoreForRating) / (maxScore - minScoreForRating); 
        let rating = normalizedScore * (maxRating - minRating) + minRating;

        // 0.5 ‡¶∏‡ßç‡¶ü‡ßá‡¶™‡ßá ‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶æ
        rating = Math.round(rating * 2) / 2;
        
        return parseFloat(rating.toFixed(1));
    }


    // ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®: ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶ï‡¶® ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá
    function renderStarRating(rawScore) {
        const ratingBar = document.getElementById('trustRatingBar');
        if (!ratingBar) return;

        // üî• ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶ó‡¶£‡¶®‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞
        const score = mapScoreToFiveStarRating(rawScore); 
        ratingBar.innerHTML = ''; 
        
        const roundedScore = Math.round(score * 2) / 2; 

        let html = '';
        for (let i = 1; i <= 5; i++) {
            if (roundedScore >= i) {
                html += `<i class="fas fa-star star filled-star"></i>`;
            } else if (roundedScore === i - 0.5) {
                html += `<i class="fas fa-star-half-alt star filled-star"></i>`;
            } else {
                html += `<i class="far fa-star star empty-star"></i>`;
            }
        }
        
        // üî• Raw score ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá:
        html += `<span class="text-lg font-bold ml-2 text-gray-800">(${score.toFixed(1)} ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞)</span>`;
        html += `<span class="text-sm text-gray-500 ml-2">(${rawScore.toLocaleString('bn-BD')} ‡¶∏‡ßç‡¶ï‡ßã‡¶∞)</span>`;
        
        ratingBar.innerHTML = html;
    }
    
    // ======================================================================
    // üî• ‡¶¨‡ßç‡¶≤‡ßÅ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶ü‡ßá‡¶∞‡¶ø‡ßü‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    // ======================================================================
    /**
     * ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶¨‡ßç‡¶≤‡ßÅ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡ßÆ‡¶ü‡¶ø ‡¶ï‡¶†‡ßã‡¶∞ ‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶ü‡ßá‡¶∞‡¶ø‡ßü‡¶æ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßá‡•§
     * @param {object} data - Realtime DB ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ‡•§
     * @returns {Array<object>} - ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶ü‡ßá‡¶∞‡¶ø‡ßü‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶∏‡¶π ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡•§
     */
    function checkVerificationCriteria(data, userAuth) {
        
        const facebookLinkCount = Array.isArray(data.facebookLinks) 
                                ? data.facebookLinks.filter(link => link && link.trim() !== '' && link.trim() !== '#').length
                                : 0;
        
        const criteria = [
            { 
                name: '‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶Ü‡¶õ‡ßá', 
                icon: 'fas fa-envelope', 
                completed: !!userAuth.email,
                target: '‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®'
            },
            { 
                name: '‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶´‡¶ü‡ßã ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 
                icon: 'fas fa-camera', 
                completed: !!data.profilePhotoUrl,
                target: '‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®'
            },
            { 
                name: '‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶®‡¶æ‡¶Æ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 
                icon: 'fab fa-facebook', 
                completed: !!data.facebookName,
                target: '‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®'
            },
            { 
                name: '‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ßß‡¶ü‡¶ø ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 
                icon: 'fas fa-link', 
                completed: facebookLinkCount >= 1, 
                target: `‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®: ${facebookLinkCount.toLocaleString('bn-BD')}‡¶ü‡¶ø`
            },
            { 
                name: '‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡ßØ‡ß´+ (‡¶ñ‡ßÅ‡¶¨ ‡¶â‡¶ö‡ßç‡¶ö)', 
                icon: 'fas fa-star', 
                completed: (data.trustScore || 0) >= 95,
                target: `‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®: ${(data.trustScore || 0).toLocaleString('bn-BD')}`
            },
            { 
                name: '‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß´‡ß¶‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤ ‡¶ï‡¶æ‡¶ú ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 
                icon: 'fas fa-check-double', 
                completed: (data.tasksCompleted || 0) >= 50,
                target: `‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®: ${(data.tasksCompleted || 0).toLocaleString('bn-BD')}‡¶ü‡¶ø`
            },
            { 
                name: '‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡ßß‡ß¶‡¶ü‡¶ø‡¶∞ ‡¶ï‡¶Æ', 
                icon: 'fas fa-ban', 
                completed: (data.tasksRejected || 0) < 10,
                target: `‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®: ${(data.tasksRejected || 0).toLocaleString('bn-BD')}‡¶ü‡¶ø`
            },
            { 
                name: '‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß´ ‡¶ú‡¶® ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡¶´‡¶≤', 
                icon: 'fas fa-users', 
                completed: (data.referralSuccesses || 0) >= 5,
                target: `‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®: ${(data.referralSuccesses || 0).toLocaleString('bn-BD')} ‡¶ú‡¶®`
            }
        ];
        
        return criteria;
    }
    
    /**
     * ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ UI ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßá‡•§
     * @param {Array<object>} criteria - ‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶ü‡ßá‡¶∞‡¶ø‡ßü‡¶æ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶∏‡¶π ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∞‡ßá‡•§
     */
    function renderVerificationStatus(criteria, profileData) {
        const listContainer = document.getElementById('verification-criteria-list');
        const totalCriteria = criteria.length;
        const completedCriteria = criteria.filter(c => c.completed).length;
        const percentage = (completedCriteria / totalCriteria) * 100;
        
        const isFullyVerified = completedCriteria === totalCriteria;
        
        const progressBarElement = document.getElementById('verification-progress-bar');
        const cardHeader = document.getElementById('blueVerifySection');


        // --- UI ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶ø‡¶Ç ‡¶ì ‡¶™‡ßç‡¶∞‡ßã‡¶ó‡ßç‡¶∞‡ßá‡¶∏ ‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ---
        if (isFullyVerified) {
            progressBarElement.classList.remove('bg-blue-500');
            progressBarElement.classList.add('bg-green-500');
            cardHeader.classList.remove('border-blue-500', 'bg-blue-50/50');
            cardHeader.classList.add('border-green-500', 'bg-green-50/50');
        } else {
            progressBarElement.classList.remove('bg-green-500');
            progressBarElement.classList.add('bg-blue-500');
            cardHeader.classList.remove('border-green-500', 'bg-green-50/50');
            cardHeader.classList.add('border-blue-500', 'bg-blue-50/50');
        }

        document.getElementById('verification-progress-text').textContent = 
            `${completedCriteria.toLocaleString('bn-BD')}/${totalCriteria.toLocaleString('bn-BD')}‡¶ü‡¶ø ‡¶∂‡¶∞‡ßç‡¶§ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶π‡ßü‡ßá‡¶õ‡ßá`;
        document.getElementById('verification-percentage').textContent = 
            `${Math.round(percentage)}%`;
        document.getElementById('verification-progress-bar').style.width = 
            `${percentage}%`;

        // ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞
        listContainer.innerHTML = criteria.map(item => `
            <div class="verification-criteria-item">
                <span class="criteria-text ${item.completed ? 'text-gray-800' : 'text-gray-500'}">
                    <i class="${item.icon} w-5 text-center ${item.completed ? 'text-green-500' : 'text-blue-400'}"></i>
                    ${item.name}
                </span>
                <span class="criteria-status flex items-center gap-2 text-sm">
                    <span class="text-gray-500 text-xs hidden sm:inline-block">${item.target}</span>
                    ${item.completed 
                        ? '<i class="fas fa-check-circle text-lg text-green-500"></i>' 
                        : '<i class="fas fa-circle-notch text-lg text-blue-400"></i>'}
                </span>
            </div>
        `).join('');
        
        // --- ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü (‡¶§‡¶æ‡ßé‡¶ï‡ßç‡¶∑‡¶£‡¶ø‡¶ï ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§) ---
        if (profileData.isVerified) {
            applyButton.disabled = true;
            applyButton.textContent = '‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡¶á ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶° ‡¶á‡¶â‡¶ú‡¶æ‡¶∞';
            applyButton.classList.remove('brand-blue', 'bg-gray-400', 'bg-orange-500');
            applyButton.classList.add('bg-green-600');
        } else if (isFullyVerified) {
            applyButton.disabled = false;
            applyButton.textContent = '‡¶¨‡ßç‡¶≤‡ßÅ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®';
            applyButton.classList.remove('bg-gray-400', 'bg-green-600');
            applyButton.classList.add('brand-blue');
        } else {
            applyButton.disabled = true;
            applyButton.textContent = '‡¶¨‡ßç‡¶≤‡ßÅ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡ßá‡¶§‡ßá ‡¶∏‡¶ï‡¶≤ ‡¶∂‡¶∞‡ßç‡¶§ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®';
            applyButton.classList.remove('brand-blue', 'bg-green-600');
            applyButton.classList.add('bg-gray-400');
        }

        return isFullyVerified;
    }
    
    // ======================================================================
    // üî• ‡¶Æ‡ßÇ‡¶≤ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    // ======================================================================
    
    // Function to update the profile display elements
    function updateProfileUI(data, userAuth) { // userAuth ‡¶™‡ßç‡¶Ø‡¶æ‡¶∞‡¶æ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
        currentProfileData = data; // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        
        const profileAvatarContainer = document.getElementById('profile-avatar-container');
        profileAvatarContainer.innerHTML = '';
        
        // Avatar setup
        const avatarElement = document.createElement(data.profilePhotoUrl ? 'img' : 'div');
        if (data.profilePhotoUrl) {
             // Cloudinary URL ‡¶•‡¶æ‡¶ï‡¶≤‡ßá <img src="..."> ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
            avatarElement.src = data.profilePhotoUrl; 
            avatarElement.alt = data.facebookName;
            avatarElement.className = 'profile-avatar';
        } else {
             // Cloudinary URL ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü Avatar ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
            avatarElement.className = 'avatar-circle';
            avatarElement.textContent = (data.facebookName ? data.facebookName.charAt(0) : 'A').toUpperCase();
        }
        profileAvatarContainer.appendChild(avatarElement);

        // Verified Badge setup (Icon changed to look like Facebook)
        const verifiedBadge = document.createElement('span');
        verifiedBadge.className = 'verified-badge';
        verifiedBadge.innerHTML = '<i class="fa fa-check" aria-hidden="true"></i>'; 
        
        // üî• ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
        const verificationStatus = checkVerificationCriteria(data, userAuth);
        renderVerificationStatus(verificationStatus, data); // UI ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßá

        // ‡¶Ø‡¶¶‡¶ø isVerified ‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ó true ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶¨‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
        if (data.isVerified) { 
            profileAvatarContainer.appendChild(verifiedBadge);
            document.getElementById('blueVerifySection').classList.remove('border-blue-500', 'bg-blue-50/50');
            document.getElementById('blueVerifySection').classList.add('border-green-500', 'bg-green-50/50');
        }
        
        // ‡¶°‡ßá‡¶ü‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶´‡¶≤ ‡¶ì ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶®‡¶ø‡¶®
        const completedWorks = data.tasksCompleted || 0;
        const rejectedWorks = data.tasksRejected || 0;
        const userPoints = data.points || 0; // ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡¶ø‡¶®

        // Update Stats
        document.getElementById('userName').textContent = data.facebookName || '‡¶®‡¶æ‡¶Æ ‡¶®‡ßá‡¶á';
        // ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
        document.getElementById('userPoints').textContent = userPoints.toLocaleString('bn-BD'); 
        
        document.getElementById('successfulWorks').textContent = completedWorks.toLocaleString('bn-BD');
        document.getElementById('failedWorks').textContent = rejectedWorks.toLocaleString('bn-BD');
        
        // ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø‡¶§‡¶æ ‡¶∞‡ßá‡¶ü‡¶ø‡¶Ç ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        const rawtrustScore = data.trustScore !== undefined ? data.trustScore : 100;
        renderStarRating(rawtrustScore);
        
        // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ï‡ßã‡¶° ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶™‡¶ø ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
        const referralCode = data.referralCode || '‡¶ï‡ßã‡¶° ‡¶®‡ßá‡¶á'; 
        document.getElementById('referralCodeDisplay').textContent = referralCode;
        document.getElementById('copyReferralButton').onclick = () => copyReferralCode(referralCode);
        
        // ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§‡¶∏‡¶æ‡¶™‡ßá‡¶ï‡ßç‡¶∑ ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶® (‡¶è‡¶ñ‡¶® ‡¶è‡¶ü‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶∞ ‡¶≠‡¶ø‡¶§‡¶∞‡ßá‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø DIV)
        const referrerInputCard = document.getElementById('referrerInputCard');
        if (!data.referrerCode || data.referrerCode === '') {
            referrerInputCard.classList.remove('hidden');
        } else {
            referrerInputCard.classList.add('hidden');
        }
        
        // üî• ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï: ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶≤‡ßá ‡¶≤‡ßá‡¶Ü‡¶â‡¶ü ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
        const pointCard = document.getElementById('pointCardContainer');
        const otherStats = document.getElementById('otherStatsContainer');
        const POINT_THRESHOLD = 1000; // ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶•‡ßç‡¶∞‡ßá‡¶∂‡¶π‡ßã‡¶≤‡ßç‡¶° ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
        
        if (userPoints > POINT_THRESHOLD) {
            // ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡ßá‡¶∂‡¶ø: ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶¨‡¶°‡¶º ‡¶π‡¶¨‡ßá (2/3 ‡¶Ö‡¶Ç‡¶∂) ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡¶ó‡ßÅ‡¶≤‡ßã ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶ö‡¶≤‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
            pointCard.classList.add('point-card-large');
            otherStats.classList.add('other-stats-full');
            // ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶¶‡ßÅ‡¶ü‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡¶ï‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶Ü‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶´‡ßç‡¶≤‡ßá‡¶ï‡ßç‡¶∏ ‡¶ó‡ßç‡¶∞‡¶ø‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
            otherStats.style.marginTop = '0.15rem'; 

        } else {
            // ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶Æ ‡¶¨‡¶æ ‡¶∏‡¶Æ‡¶æ‡¶®: ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶≤‡ßá‡¶Ü‡¶â‡¶ü (‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü 1/3, ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶¶‡ßÅ‡¶ü‡¶ø 2/3)
            pointCard.classList.remove('point-card-large');
            otherStats.classList.remove('other-stats-full');
            otherStats.style.marginTop = '0'; 
        }

    }
    
    // Firebase Auth State Listener
    onAuthStateChanged(auth, async (user) => {
        if (!user) {
            window.location.href = 'login.html'; // ‡¶Ø‡¶¶‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶á‡¶® ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá, ‡¶§‡¶¨‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡ßá‡¶ú‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®
            return;
        }

        userId = user.uid;
        document.getElementById('userIdDisplay').textContent = user.uid;
        document.getElementById('userEmailDisplay').textContent = user.email || '‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶®‡ßá‡¶á';
        
        const userProfileRef = ref(rtdb, `users/${userId}`);
        
        // Realtime listener for user profile data
        onValue(userProfileRef, async (snapshot) => {
            let data = snapshot.val(); // Use 'let' to allow modification

            if (data) {
                
                // üî• ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¨‡¶æ‡¶¶ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶≤‡ßã
                if (!data.referralCode) {
                    console.log("Referral code is missing. Assuming it will be created on sign up or a fallback is needed.");
                    // ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶° ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶¨‡ßá ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá '‡¶ï‡ßã‡¶° ‡¶®‡ßá‡¶á' ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá (updateProfileUI ‡¶è‡¶∞ ‡¶´‡¶≤‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï)
                }
                
                updateProfileUI(data, user); // user object ‡¶™‡¶æ‡¶∏ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
            } else {
                // Create default profile if it doesn't exist
                
                const defaultData = {
                    facebookName: user.email ? user.email.split('@')[0] : '‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ',
                    email: user.email || '‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶®‡ßá‡¶á',
                    facebookLinks: ['#'],
                    isVerified: false,
                    tasksCreated: 0,
                    tasksCompleted: 0,
                    tasksRejected: 0,
                    points: 0,
                    profilePhotoUrl: '',
                    referrerCode: '', 
                    trustScore: 100, 
                    referralCode: '‡¶ï‡ßã‡¶° ‡¶®‡ßá‡¶á',
                    blueVerifyStatus: 'None' // ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶ø‡¶≤‡ßç‡¶°: ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®‡ßá‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ
                };
                set(userProfileRef, defaultData)
                    .then(() => console.log("Default profile created in RTDB."))
                    .catch((error) => console.error("Error creating default profile in RTDB:", error));
            }
            loadingOverlay.classList.add('hidden');
            profileContainer.classList.remove('hidden');
        });
    });
    
</script>

</body>
</html>

